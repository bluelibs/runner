<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@bluelibs/runner - v1.5.0</title><meta name="description" content="Documentation for @bluelibs/runner"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><style>
@media (prefers-color-scheme: dark) {
  :root {
    --md-sys-color-primary: #60d4fe;
    --md-sys-color-on-primary: #003545;
    --md-sys-color-primary-container: #004d62;
    --md-sys-color-on-primary-container: #bbe9ff;
    --md-sys-color-secondary: #b4cad5;
    --md-sys-color-on-secondary: #1e333c;
    --md-sys-color-secondary-container: #354a53;
    --md-sys-color-on-secondary-container: #cfe6f1;
    --md-sys-color-tertiary: #c5c3ea;
    --md-sys-color-on-tertiary: #2d2d4d;
    --md-sys-color-tertiary-container: #444465;
    --md-sys-color-on-tertiary-container: #e2dfff;
    --md-sys-color-error: #ffb4ab;
    --md-sys-color-on-error: #690005;
    --md-sys-color-error-container: #93000a;
    --md-sys-color-on-error-container: #ffb4ab;
    --md-sys-color-background: #191c1e;
    --md-sys-color-on-background: #e1e3e4;
    --md-sys-color-surface: #191c1e;
    --md-sys-color-on-surface: #e1e3e4;
    --md-sys-color-surface-variant: #40484c;
    --md-sys-color-on-surface-variant: #c0c8cc;
    --md-sys-color-outline: #8a9296;
    --md-sys-color-outline-variant: #40484c;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #e1e3e4;
    --md-sys-color-inverse-on-surface: #2e3132;
    --md-sys-color-inverse-primary: #006782;
    --md-sys-color-surface-dim: #111415;
    --md-sys-color-surface-bright: #373a3b;
    --md-sys-color-surface-container-lowest: #0c0f10;
    --md-sys-color-surface-container-low: #191c1e;
    --md-sys-color-surface-container: #1d2022;
    --md-sys-color-surface-container-high: #272a2c;
    --md-sys-color-surface-container-highest: #323537
  }
}
:root[data-theme="dark"] {
  --md-sys-color-primary: #60d4fe;
  --md-sys-color-on-primary: #003545;
  --md-sys-color-primary-container: #004d62;
  --md-sys-color-on-primary-container: #bbe9ff;
  --md-sys-color-secondary: #b4cad5;
  --md-sys-color-on-secondary: #1e333c;
  --md-sys-color-secondary-container: #354a53;
  --md-sys-color-on-secondary-container: #cfe6f1;
  --md-sys-color-tertiary: #c5c3ea;
  --md-sys-color-on-tertiary: #2d2d4d;
  --md-sys-color-tertiary-container: #444465;
  --md-sys-color-on-tertiary-container: #e2dfff;
  --md-sys-color-error: #ffb4ab;
  --md-sys-color-on-error: #690005;
  --md-sys-color-error-container: #93000a;
  --md-sys-color-on-error-container: #ffb4ab;
  --md-sys-color-background: #191c1e;
  --md-sys-color-on-background: #e1e3e4;
  --md-sys-color-surface: #191c1e;
  --md-sys-color-on-surface: #e1e3e4;
  --md-sys-color-surface-variant: #40484c;
  --md-sys-color-on-surface-variant: #c0c8cc;
  --md-sys-color-outline: #8a9296;
  --md-sys-color-outline-variant: #40484c;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #e1e3e4;
  --md-sys-color-inverse-on-surface: #2e3132;
  --md-sys-color-inverse-primary: #006782;
  --md-sys-color-surface-dim: #111415;
  --md-sys-color-surface-bright: #373a3b;
  --md-sys-color-surface-container-lowest: #0c0f10;
  --md-sys-color-surface-container-low: #191c1e;
  --md-sys-color-surface-container: #1d2022;
  --md-sys-color-surface-container-high: #272a2c;
  --md-sys-color-surface-container-highest: #323537
}

@media (prefers-color-scheme: light) {
  :root {
    --md-sys-color-primary: #006782;
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #bbe9ff;
    --md-sys-color-on-primary-container: #001f29;
    --md-sys-color-secondary: #4c616b;
    --md-sys-color-on-secondary: #ffffff;
    --md-sys-color-secondary-container: #cfe6f1;
    --md-sys-color-on-secondary-container: #071e26;
    --md-sys-color-tertiary: #5c5b7e;
    --md-sys-color-on-tertiary: #ffffff;
    --md-sys-color-tertiary-container: #e2dfff;
    --md-sys-color-on-tertiary-container: #181837;
    --md-sys-color-error: #ba1a1a;
    --md-sys-color-on-error: #ffffff;
    --md-sys-color-error-container: #ffdad6;
    --md-sys-color-on-error-container: #410002;
    --md-sys-color-background: #fbfcfe;
    --md-sys-color-on-background: #191c1e;
    --md-sys-color-surface: #fbfcfe;
    --md-sys-color-on-surface: #191c1e;
    --md-sys-color-surface-variant: #dce4e8;
    --md-sys-color-on-surface-variant: #40484c;
    --md-sys-color-outline: #70787d;
    --md-sys-color-outline-variant: #c0c8cc;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #2e3132;
    --md-sys-color-inverse-on-surface: #eff1f3;
    --md-sys-color-inverse-primary: #60d4fe;
    --md-sys-color-surface-dim: #d8dadc;
    --md-sys-color-surface-bright: #f8f9fb;
    --md-sys-color-surface-container-lowest: #ffffff;
    --md-sys-color-surface-container-low: #f2f4f5;
    --md-sys-color-surface-container: #edeef0;
    --md-sys-color-surface-container-high: #e7e8ea;
    --md-sys-color-surface-container-highest: #e1e3e4
  }
}
:root[data-theme="light"] {
  --md-sys-color-primary: #006782;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #bbe9ff;
  --md-sys-color-on-primary-container: #001f29;
  --md-sys-color-secondary: #4c616b;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-secondary-container: #cfe6f1;
  --md-sys-color-on-secondary-container: #071e26;
  --md-sys-color-tertiary: #5c5b7e;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-tertiary-container: #e2dfff;
  --md-sys-color-on-tertiary-container: #181837;
  --md-sys-color-error: #ba1a1a;
  --md-sys-color-on-error: #ffffff;
  --md-sys-color-error-container: #ffdad6;
  --md-sys-color-on-error-container: #410002;
  --md-sys-color-background: #fbfcfe;
  --md-sys-color-on-background: #191c1e;
  --md-sys-color-surface: #fbfcfe;
  --md-sys-color-on-surface: #191c1e;
  --md-sys-color-surface-variant: #dce4e8;
  --md-sys-color-on-surface-variant: #40484c;
  --md-sys-color-outline: #70787d;
  --md-sys-color-outline-variant: #c0c8cc;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #2e3132;
  --md-sys-color-inverse-on-surface: #eff1f3;
  --md-sys-color-inverse-primary: #60d4fe;
  --md-sys-color-surface-dim: #d8dadc;
  --md-sys-color-surface-bright: #f8f9fb;
  --md-sys-color-surface-container-lowest: #ffffff;
  --md-sys-color-surface-container-low: #f2f4f5;
  --md-sys-color-surface-container: #edeef0;
  --md-sys-color-surface-container-high: #e7e8ea;
  --md-sys-color-surface-container-highest: #e1e3e4
}
</style><link rel="stylesheet" href="assets/material-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@bluelibs/runner - v1.5.0</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@bluelibs/runner - v1.5.0</h2></div><div class="tsd-panel tsd-typography"><a id="md:bluelibs-runner" class="tsd-anchor"></a><h1 class="tsd-anchor-link">BlueLibs Runner<a href="#md:bluelibs-runner" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p align="center">
<a href="https://github.com/bluelibs/runner/actions/workflows/ci.yml"><img src="https://github.com/bluelibs/runner/actions/workflows/ci.yml/badge.svg?branch=main" alt="Build Status" /></a>
<a href="https://coveralls.io/github/bluelibs/runner?branch=main"><img src="https://coveralls.io/repos/github/bluelibs/runner/badge.svg?branch=main" alt="Coverage Status" /></a>
<a href="https://bluelibs.github.io/runner/" target="_blank"><img src="https://img.shields.io/badge/read-typedocs-blue" alt="Docs" /></a>
</p>
<ul>
<li><a href="https://bluelibs.github.io/runner/" target="_blank" class="external">View the documentation page here</a>.</li>
<li><a href="https://notebooklm.google.com/notebook/59bd49fa-346b-4cfb-bb4b-b59857c3b9b4/audio" target="_blank" class="external">Google Notebook LM Podcast</a></li>
<li><a href="https://chatgpt.com/share/670392f8-7188-800b-9b4b-e49b437d77f7" target="_blank" class="external">Continue GPT Conversation</a></li>
</ul>
<p>BlueLibs Runner is a framework that provides a functional approach to building applications, whether small or large-scale. Its core concepts include Tasks, Resources, Events, and Middleware. Tasks represent the units of logic, while resources are singletons that provide shared services across the application. Events facilitate communication between different parts of the system, and Middleware allows interception and modification of task execution. The framework emphasizes an async-first philosophy, ensuring that all operations are executed asynchronously for smoother application flow.</p>
<a id="md:building-blocks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Building Blocks<a href="#md:building-blocks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Tasks</strong>: Core units of logic that encapsulate specific tasks. They can depend on resources, other tasks, and event emitters.</li>
<li><strong>Resources</strong>: Singleton objects providing shared functionality. They can be constants, services, functions. They can depend on other resources, tasks, and event emitters.</li>
<li><strong>Events</strong>: Facilitate asynchronous communication between different parts of your application. All tasks and resources emit events, allowing you to easily hook. Events can be listened to by tasks, resources, and middleware.</li>
<li><strong>Middleware</strong>: Intercept and modify the execution of tasks or initialisation of your resources. They can be used to add additional functionality to your tasks. Middleware can be global or task-specific.</li>
</ul>
<p>These are the concepts and philosophy:</p>
<ul>
<li><strong>Async</strong>: Everything is async, no more sync code for this framework. Sync-code can be done via resource services or within tasks, but the high-level flow needs to run async.</li>
<li><strong>Type safety</strong>: Built with TypeScript for enhanced developer experience and type-safety everywhere, no more type mistakes.</li>
<li><strong>Functional</strong>: We use functions and objects instead of classes for DI. This is a functional approach to building applications.</li>
<li><strong>Explicit Registration</strong>: All tasks, resources, events, and middleware have to be explicitly registered to be used.</li>
<li><strong>Dependencies</strong>: Tasks, resources, and middleware can have access to each other by depending on one another and event emitters. This is a powerful way to explicitly declare the dependencies.</li>
</ul>
<p>Resources return their value to the container using the async <code>init()</code> function, making them available throughout the application.</p>
<p>Tasks provide their output through the async <code>run()</code> function, allowing the results to be used across the application.</p>
<p>All tasks, resources, events, and middleware must be explicitly registered to be used. Registration can only be done within resources.</p>
<a id="md:installation" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Installation<a href="#md:installation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@bluelibs/runner</span>
</code><button type="button">Copy</button></pre>

<a id="md:basic-usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Basic Usage<a href="#md:basic-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">minimal</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello world!&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">minimal</span><span class="hl-1">).</span><span class="hl-0">then</span><span class="hl-1">((</span><span class="hl-4">result</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello world!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:resources-and-tasks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Resources and Tasks<a href="#md:resources-and-tasks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Resources are singletons and can include constants, services, functions, and more. They can depend on other resources, tasks, and event emitters.</p>
<p>Tasks are designed to be trackable units of logic, such as handling specific routes on your HTTP server or performing actions needed by different parts of the application. This makes it easy to monitor what’s happening in your application.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">helloTask</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">hello:</span><span class="hl-1"> </span><span class="hl-4">helloTask</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">hello</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">); </span><span class="hl-7">// &quot;Hello World!&quot;</span>
</code><button type="button">Copy</button></pre>

<a id="md:when-to-use-each" class="tsd-anchor"></a><h3 class="tsd-anchor-link">When to use each?<a href="#md:when-to-use-each" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>It is unrealistic to create a task for everything you're doing in your system, not only it will be tedious for the developer, but it will affect performance unnecessarily. The idea is to think of a task of something that you want trackable as a higher-level action, for example:</p>
<ul>
<li>&quot;app.user.register&quot; - this is a task, registers the user, returns a token</li>
<li>&quot;app.user.createComment&quot; - this is a task, creates a comment, returns the comment maybe</li>
<li>&quot;app.user.updateFriendList&quot; - this task can be re-used from many other tasks or resources as necessary</li>
</ul>
<p>Resources are more like services, they are singletons, they are meant to be used as a shared functionality across your application. They can be constants, services, functions, etc.</p>
<a id="md:resource-dispose" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Resource dispose()<a href="#md:resource-dispose" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Resources can include a <code>dispose()</code> method for cleanup tasks. This is useful for actions like closing database connections. You should use <code>dispose()</code> when you have open connections or need to perform cleanup during a graceful shutdown.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">dbResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">db</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">connectToDatabase</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-7">// the value returned from init() will be passed to dispose()</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">dispose</span><span class="hl-1">(</span><span class="hl-4">db</span><span class="hl-1">, </span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>To call dispose(), you need to use the global resource called store, since everything is encapsulated. This allows you to access the internal parts of the system to start the disposal process.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">dbResource</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">store:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">store</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// We use the fact that we can reuse the value we got from here</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">dispose</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-4">store</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">(),</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">value</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span><br/><span class="hl-7">// To begin the disposal process.</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">value</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:resource-configuration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Resource configuration<a href="#md:resource-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Resources can be set up with a configuration object, which is helpful for passing in specific settings. For example, if you’re building a library and initializing a mailer service, you can provide the SMTP credentials through this configuration.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-8">Config</span><span class="hl-1"> = { </span><span class="hl-4">smtpUrl</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">defaultFrom</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> };</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">emailerResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-7">// automatic type inference.</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-8">Config</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// todo: perform config checks with a library like zod</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">sendEmail</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">to</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-4">subject</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">// send *email*</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-7">// proper autocompletion is present</span><br/><span class="hl-1">    </span><span class="hl-4">emailerResource</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">smtpUrl:</span><span class="hl-1"> </span><span class="hl-2">&quot;smtp://localhost&quot;</span><span class="hl-1">, </span><span class="hl-4">defaultFrom:</span><span class="hl-1"> </span><span class="hl-2">&quot;&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>If by any chance your main <code>app</code> has configs then they will be passed via the second argument of <code>run</code>, like this:</p>
<pre><code class="ts"><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">, </span><span class="hl-4">config</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:dependencies" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Dependencies<a href="#md:dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can depend on <code>tasks</code>, <code>resources</code>, <code>events</code> and (indirectly) on <code>middleware</code>.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><span class="hl-4">logMiddleware</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">userRegisteredEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">userRegisteredEvent</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// You have to register everything you use.</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">helloWorld</span><span class="hl-1">, </span><span class="hl-4">logMiddleware</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">helloWorld</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">helloWorld</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>We have a circular dependency checker to ensure consistency. If a circular dependency is found, an error will be thrown, showing the exact paths involved.</p>
<p>Tasks, however, are not bound by this restriction; they can freely depend on each other as needed.</p>
<p>The dependencies get injected as follows:</p>
<table>
<thead>
<tr>
<th>Component</th>
<th>Injection Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>tasks</code></td>
<td>Injected as functions with their input argument</td>
</tr>
<tr>
<td><code>resources</code></td>
<td>Injected as their return value</td>
</tr>
<tr>
<td><code>events</code></td>
<td>Injected as functions with their payload argument</td>
</tr>
<tr>
<td><code>middleware</code></td>
<td>Not typically injected; used via a <code>middleware: []</code> array</td>
</tr>
</tbody>
</table>
<a id="md:events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Events<a href="#md:events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Events are triggered when specific actions occur in your app, like a user registration or a new comment. When you catch these events, you also receive the emitted data along with the source of the event. Knowing the source of the event without explicitly specifying it can be very helpful in large applications.</p>
<p>You can listen for these events using tasks and resources, and similarly, emit them from tasks and resources through dependencies.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">afterRegisterEvent</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.user.afterRegister&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">root</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// the event becomes a function that you run with the propper payload</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">afterRegisterEvent</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">string</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>There are only 2 recommended ways to listen to events:</p>
<a id="md:taskon-property" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><code>task.on</code> property<a href="#md:taskon-property" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">afterRegisterEvent</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.user.afterRegister&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">listenerPriority:</span><span class="hl-1"> </span><span class="hl-9">0</span><span class="hl-1">, </span><span class="hl-7">// this is the order in which the task will be executed when `on` is present</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1">; </span><span class="hl-7">// id which middleware, task, resource triggered it</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;User has been registered!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">, </span><span class="hl-4">helloTask</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">afterRegisterEvent</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-2">&quot;XXX&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:resourcehooks-property" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><code>resource.hooks</code> property<a href="#md:resourcehooks-property" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>This can only be applied to a <code>resource()</code>.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">global</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">afterRegisterEvent</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.user.registered&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">root</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {},</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">global</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterInit</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">order:</span><span class="hl-1"> -</span><span class="hl-9">1000</span><span class="hl-1">, </span><span class="hl-7">// event priority, the lower the number, the sooner it will run.</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-7">// both dependencies and event are properly infered through typescript</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;User has been registered!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">afterRegisterEvent</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-2">&quot;XXX&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:wildcard-events" class="tsd-anchor"></a><h4 class="tsd-anchor-link">wildcard events<a href="#md:wildcard-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>You can listen to all events by using the wildcard <code>*</code>.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">global</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">afterRegisterEvent</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.user.registered&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">root</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">afterRegisterEvent</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {},</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-2">&quot;*&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-2">&quot;Generic event detected&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-0">afterRegisterEvent</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-2">&quot;XXX&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>When using hooks, inside resource() you benefit of autocompletion, in order to keep things clean, if your hooks become large and long consider switching to tasks and <code>on</code>. This is a more explicit way to listen to events, and your resource registers them.</p>
<p>The hooks from a <code>resource</code> are mostly used for configuration, and blending in the system.</p>
<a id="md:when-to-use-either" class="tsd-anchor"></a><h3 class="tsd-anchor-link">When to use either?<a href="#md:when-to-use-either" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>hooks</code> are for resources to extend each other, compose functionalities, they are mostly used for configuration and blending in the system.</li>
<li><code>on</code> is for when you want to perform a task when something happens, like send an email, begin processing something, etc.</li>
</ul>
<a id="md:middleware" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Middleware<a href="#md:middleware" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Middleware intercepts the execution of tasks or the initialization of resources, providing a powerful means to enhance functionality. The order in which middleware is registered dictates its execution priority: the first middleware registered is the first to run, while the last middleware in the middleware array at the task level is the closest to the task itself, executing just before the task completes. (Imagine an onion if you will, with the task at the core.)</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">logMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.log&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// inject tasks, resources, eventCallers here.</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">taskDefinition</span><span class="hl-1">, </span><span class="hl-6">resourceDefinition</span><span class="hl-1">, </span><span class="hl-6">config</span><span class="hl-1">, </span><span class="hl-6">next</span><span class="hl-1">, </span><span class="hl-6">input</span><span class="hl-1"> } = </span><span class="hl-4">data</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-7">// The middleware can be for a task or a resource, depending on which you get the right elements.</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">taskDefinition</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Before task&quot;</span><span class="hl-1">, </span><span class="hl-4">taskDefinition</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">input</span><span class="hl-1">); </span><span class="hl-7">// pass the input to the next middleware or task</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;After task&quot;</span><span class="hl-1">, </span><span class="hl-4">taskDefinition</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-3">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Before resource&quot;</span><span class="hl-1">, </span><span class="hl-4">resourceDefinition</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">); </span><span class="hl-7">// pass the input to the next middleware or task</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;After resource&quot;</span><span class="hl-1">, </span><span class="hl-4">resourceDefinition</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.hello&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><span class="hl-4">logMiddleware</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;User has been registered!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:global" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Global<a href="#md:global" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>If you want to register a middleware for all tasks and resources, here's how you can do it:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">logMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.log&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// ... rest</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">root</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">logMiddleware</span><span class="hl-1">.</span><span class="hl-0">global</span><span class="hl-1">() </span><span class="hl-7">/* this will apply to all tasks */</span><span class="hl-1">],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The middleware can only be registered once. This means that if you register a middleware as global, you cannot specify it as a task middleware. This is to avoid confusion and to keep the system clean.</p>
<a id="md:errors" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Errors<a href="#md:errors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>If an error is thrown in a task, the error will be propagated up to the top runner.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Something went wrong&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">helloWorld</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">helloWorld</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">helloWorld</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">).</span><span class="hl-0">catch</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-4">err</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>You can listen to errors via events:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.helloWorld.onError&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">helloWorld</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">onError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">({ </span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">input</span><span class="hl-1">, </span><span class="hl-4">suppress</span><span class="hl-1"> }, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// this will be called when an error happens</span><br/><br/><span class="hl-1">    </span><span class="hl-7">// if you handled the error, and you don&#39;t want it propagated to the top, supress the propagation.</span><br/><span class="hl-1">    </span><span class="hl-0">suppress</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.resources.helloWorld.onError&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">helloWorld</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">onError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-1">({ </span><span class="hl-4">error</span><span class="hl-1">, </span><span class="hl-4">input</span><span class="hl-1">, </span><span class="hl-4">suppress</span><span class="hl-1"> }, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// this will be called when an error happens</span><br/><br/><span class="hl-1">    </span><span class="hl-7">// if you handled the error, and you don&#39;t want it propagated to the top, supress the propagation.</span><br/><span class="hl-1">    </span><span class="hl-0">suppress</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:meta" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Meta<a href="#md:meta" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>You can attach metadata to tasks, resources, events, and middleware.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;This is a hello world task&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;api&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>This is particularly helpful to use in conjunction with global middlewares, or global events, they can read some meta tag definition and act accordingly, decorate them or log them.</p>
<p>The interfaces look like this:</p>
<pre><code class="ts"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-8">IMeta</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">title</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">description</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">tags</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">[];</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-8">ITaskMeta</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-8">IMeta</span><span class="hl-1"> {}</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-8">IResourceMeta</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-8">IMeta</span><span class="hl-1"> {}</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-8">IEventMeta</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-8">IMeta</span><span class="hl-1"> {}</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">interface</span><span class="hl-1"> </span><span class="hl-8">IMiddlewareMeta</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-8">IMeta</span><span class="hl-1"> {}</span>
</code><button type="button">Copy</button></pre>

<p>Which means you can extend them in your system to add more keys to better describe your actions.</p>
<a id="md:internal-services" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Internal Services<a href="#md:internal-services" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We expose direct access to the following internal services:</p>
<ul>
<li>Store (contains Map()s for events, tasks, resources, middleware configurations)</li>
<li>TaskRunner (can run tasks definitions directly and within D.I. context)</li>
<li>EventManager (can emit and listen to events)</li>
</ul>
<p>Attention, we do not encourage you to use these services directly, unless you really have to, they are exposed for advanced use-case scenarios.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">store:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">store</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">taskRunner:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">taskRunner</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">eventManager:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">eventManager</span><span class="hl-1">,</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// you benefit of full autocompletion here</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:namespacing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Namespacing<a href="#md:namespacing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Domain usually is &quot;app&quot;, but as your application grows or you plan on building external libraries the naming convention should be: &quot;companyName.packageName&quot;.</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tasks</td>
<td><code>{domain}.tasks.{taskName}</code></td>
</tr>
<tr>
<td>Listener Tasks</td>
<td><code>{domain}.tasks.{taskName}.on{EventName}</code></td>
</tr>
<tr>
<td>Resources</td>
<td><code>{domain}.resources.{resourceName}</code></td>
</tr>
<tr>
<td>Events</td>
<td><code>{domain}.events.{eventName}</code></td>
</tr>
<tr>
<td>Middleware</td>
<td><code>{domain}.middleware.{middlewareName}</code></td>
</tr>
</tbody>
</table>
<p>You can always create helpers for you as you're creating your tasks, resources, middleware:</p>
<pre><code class="ts"><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">namespaced</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`bluelibs.core.</span><span class="hl-5">${</span><span class="hl-4">id</span><span class="hl-5">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<p>We need to import all the tasks, resources, events, and middlewares, a convention for their naming is to export them like this</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">userCreatedEvent</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;./events&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">events</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">userCreated:</span><span class="hl-1"> </span><span class="hl-4">userCreatedEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// ...</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">tasks</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">doSomething:</span><span class="hl-1"> </span><span class="hl-4">doSomethingTask</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">resources</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">root:</span><span class="hl-1"> </span><span class="hl-4">rootResource</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">user:</span><span class="hl-1"> </span><span class="hl-4">userResource</span><span class="hl-1">,</span><br/><span class="hl-1">};</span>
</code><button type="button">Copy</button></pre>

<p>Often the root will register all needed items, so you don't have to register anything but the root.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-5">*</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-4">packageName</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;package-name&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">packageName</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">root</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>Now you can freely use any of the tasks, resources, events, and middlewares from the <code>packageName</code> namespace.</p>
<p>This approach is very powerful when you have multiple packages and you want to compose them together.</p>
<a id="md:real-life" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Real life<a href="#md:real-life" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Or is it just fantasy?</p>
<p>Typically, an application consists of an Express server (to handle HTTP requests), a database, and various services. You can conveniently define all of these components within a single file and execute them together.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">express</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;express&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">expressServer</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.express&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">express</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-9">3000</span><span class="hl-1">).</span><span class="hl-0">then</span><span class="hl-1">(() </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Server is running on port 3000&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-7">// because we return it you can now access it via dependencies</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">setupRoutes</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.routes&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">expressServer</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-4">expressServer</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-2">&quot;/api&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">hello:</span><span class="hl-1"> </span><span class="hl-2">&quot;world&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Just run them, init() will be called everywhere.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">expressServer</span><span class="hl-1">, </span><span class="hl-4">setupRoutes</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>The system intelligently determines the order in which init() functions should be called, ensuring that all dependencies are initialized first. In the case of circular dependencies, it will throw an error, providing the exact paths to help identify the issue.</p>
<a id="md:business-config" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Business config<a href="#md:business-config" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Or just simple config, you can do it for your business logic, environment variables, etc.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// we keep it as const because we will also benefit of type-safety</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">businessData</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">pricePerSubscription:</span><span class="hl-1"> </span><span class="hl-9">9.99</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">businessConfig</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.config&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">businessData</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">businessConfig</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">businessConfig</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-4">businessConfig</span><span class="hl-1">.</span><span class="hl-4">pricePerSubscription</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:global-events" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Global Events<a href="#md:global-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:task-level" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Task level<a href="#md:task-level" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Each task and constant have their own events</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">helloWorld</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">helloWorld</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">beforeRun</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">; </span><span class="hl-7">// read the input</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">helloWorld</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterRun</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">output</span><span class="hl-1">; </span><span class="hl-7">// you can read the input or output</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">helloWorld</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">onError</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">; </span><span class="hl-7">// read the error that happened during execution</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:resource-level" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Resource level<a href="#md:resource-level" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">businessData</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">pricePerSubscription:</span><span class="hl-1"> </span><span class="hl-9">9.99</span><span class="hl-1">,</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">businessConfig</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.config&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">businessData</span><span class="hl-1">; </span><span class="hl-7">// if you use it as a const you will have full typesafety</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">businessConfig</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">businessConfig</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">beforeInit</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">config</span><span class="hl-1">; </span><span class="hl-7">// read the input</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">businessConfig</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterInit</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">value</span><span class="hl-1">; </span><span class="hl-7">// you can read the  returned value of the resource</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">businessConfig</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">onError</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">; </span><span class="hl-7">// read the error that happened during initialization</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:advanced-usage" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced Usage<a href="#md:advanced-usage" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This is just a &quot;language&quot; of developing applications. It simplifies dependency injection to the barebones, it forces you to think more functional and use classes less.</p>
<p>This doesn't mean you shouldn't use classes, just not for hooking things up together.</p>
<p>You can add many services or external things into the runner ecosystem with things like:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// proxy declaration pattern</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">expressResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">app</span><span class="hl-1">: </span><span class="hl-8">express</span><span class="hl-1">.</span><span class="hl-8">Application</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">expressResource</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">(</span><span class="hl-0">express</span><span class="hl-1">())],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">express:</span><span class="hl-1"> </span><span class="hl-4">expressResource</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">express</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&quot;/&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>This demonstrates how effortlessly an external service can be encapsulated within the runner ecosystem. This ‘pattern’ of storing objects in this manner is quite unique, as it typically involves configurations with various options, rather than directly using an Express instance like this:</p>
<pre><code class="ts"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-8">Config</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">port</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">expressResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-8">Config</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">express</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">port</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">app</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">expressResource</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-9">3000</span><span class="hl-1"> })],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">express:</span><span class="hl-1"> </span><span class="hl-4">expressResource</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">express</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// type is automagically infered.</span><br/><span class="hl-1">    </span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&quot;/&quot;</span><span class="hl-1">, (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:inter-communication-between-resources" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Inter-communication between resources<a href="#md:inter-communication-between-resources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When registering resources with specific configuration, the initialization order usually doesn’t matter. However, there are cases where it becomes crucial. For instance, consider a security service that allows the injection of a custom hashing function to transition from MD5 to SHA-256.</p>
<p>In such cases, your resource should provide a method for other resources to update it. A straightforward approach is to expose a configuration option that lets you set a custom hasher, like so:</p>
<pre><code class="ts"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-8">SecurityResourceConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">hasher</span><span class="hl-1">: (</span><span class="hl-4">str</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">securityResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.security&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-8">SecurityResourceConfig</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">hash</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-0">hasher</span><span class="hl-1">(</span><span class="hl-4">input</span><span class="hl-1">),</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">securityResource</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-0">hasher</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">md5</span><span class="hl-1">(</span><span class="hl-4">input</span><span class="hl-1">) })],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>However, other resources might need to modify this dynamically as extensions. This is where hooks become valuable.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-8">SecurityOptions</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">hashFunction</span><span class="hl-1">: (</span><span class="hl-4">input</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">securityResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.security&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-8">SecurityOptions</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">let</span><span class="hl-1"> </span><span class="hl-4">hasher</span><span class="hl-1"> = </span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">hashFunction</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-0">setHasher</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-0">hashFunction</span><span class="hl-1">: (</span><span class="hl-4">input</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">hasher</span><span class="hl-1"> = </span><span class="hl-4">hashFunction</span><span class="hl-1">;</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-0">hash</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-0">hasher</span><span class="hl-1">(</span><span class="hl-4">input</span><span class="hl-1">),</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">securityResource</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-7">// careful when you listen on such events and need dependencies, you might not have them computed yet due to how early these events happen in the system.</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">securityResource</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterInit</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">config</span><span class="hl-1">, </span><span class="hl-6">value</span><span class="hl-1"> } = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">security</span><span class="hl-1"> = </span><span class="hl-4">value</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-4">security</span><span class="hl-1">.</span><span class="hl-0">setHasher</span><span class="hl-1">((</span><span class="hl-4">input</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-7">// custom implementation here.</span><br/><span class="hl-1">        });</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Another approach is to create a new event that contains the configuration, providing the flexibility to update it as needed.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">securityConfigurationPhaseEvent</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;</span><span class="hl-8">SecurityOptions</span><span class="hl-1">&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.security.configurationPhase&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">securityResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.security&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">securityConfigurationPhaseEvent</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-8">SecurityOptions</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-7">// Give the ability to other listeners to modify the configuration</span><br/><span class="hl-1">    </span><span class="hl-0">securityConfigurationPhaseEvent</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">Objecte</span><span class="hl-1">.</span><span class="hl-0">freeze</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-7">// ... based on config</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">securityResource</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">securityConfigurationPhaseEvent</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">config</span><span class="hl-1"> } = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">; </span><span class="hl-7">// config is SecurityOptions</span><br/><span class="hl-1">        </span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-0">setHasher</span><span class="hl-1">(</span><span class="hl-4">newHashFunction</span><span class="hl-1">);</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:overrides" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Overrides<a href="#md:overrides" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Previously, we discussed how to extend functionality using events. However, there are times when you need to replace an existing resource with a new one or swap out a task or middleware imported from another package that doesn’t support such changes.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-7">// This example is for resources but override works for tasks, events, and middleware as well.</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">securityResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.security&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-7">// returns a security service</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">override</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  ...</span><span class="hl-4">securityResource</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-7">// a new and custom service</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">securityResource</span><span class="hl-1">], </span><span class="hl-7">// this resource might be registered by any element in the dependency tree.</span><br/><span class="hl-1">  </span><span class="hl-4">overrides:</span><span class="hl-1"> [</span><span class="hl-4">override</span><span class="hl-1">],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The new securityResource will replace the existing one, ensuring all future references point to the updated version.</p>
<p>Overrides work if the resource being overridden is already registered. If multiple resources attempt to override the same one, no error will be thrown. This is a common scenario, where the root resource typically contains the most authoritative overrides. But it's also to be mindful about.</p>
<a id="md:logging" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Logging<a href="#md:logging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>We expose through globals a <code>logger</code> that you can use to log things. Essentially what this service does it emits a <code>global.events.log</code> event with an <code>ILog</code> object.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">logger</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-7">// or logger.log(level, data);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:logs-summary-table" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Logs Summary Table<a href="#md:logs-summary-table" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Log Level</th>
<th>Description</th>
<th>Usage Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>trace</strong></td>
<td>Very detailed logs, usually for debugging</td>
<td>&quot;Entering function X with params Y.&quot;</td>
</tr>
<tr>
<td><strong>debug</strong></td>
<td>Detailed debug information</td>
<td>&quot;Fetching user data: userId=123.&quot;</td>
</tr>
<tr>
<td><strong>info</strong></td>
<td>General application information</td>
<td>&quot;Service started on port 8080.&quot;</td>
</tr>
<tr>
<td><strong>warn</strong></td>
<td>Indicates a potential issue</td>
<td>&quot;Disk space running low.&quot;</td>
</tr>
<tr>
<td><strong>error</strong></td>
<td>Indicates a significant problem</td>
<td>&quot;Unable to connect to database.&quot;</td>
</tr>
<tr>
<td><strong>critical</strong></td>
<td>Serious problem causing a crash</td>
<td>&quot;System out of memory, shutting down.&quot;</td>
</tr>
</tbody>
</table>
<a id="md:print-logs" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Print logs<a href="#md:print-logs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Logs don't get printed by default. You have to set the print threshold to a certain level. This is useful when you want to print only errors and critical logs in production, but you want to print all logs in development. Your codebase, your rules.</p>
<p>To showcase the versatility of the system, here are some ways you could do it:</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">globals</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">logger</span><span class="hl-1"> } = </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">printLog</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.task.updatePrintThreshold&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterInit</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-7">// Note: logger is</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">logger</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">value</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">setPrintThreshold</span><span class="hl-1">(</span><span class="hl-2">&quot;trace&quot;</span><span class="hl-1">); </span><span class="hl-7">// will print all logs</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">setPrintThreshold</span><span class="hl-1">(</span><span class="hl-2">&quot;error&quot;</span><span class="hl-1">); </span><span class="hl-7">// will print only &quot;error&quot; and &quot;critical&quot; logs</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;root&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">printLog</span><span class="hl-1">],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// Now your app will print all logs</span>
</code><button type="button">Copy</button></pre>

<p>You can also achieve this using hooks:</p>
<pre><code class="ts"><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;root&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">hooks:</span><span class="hl-1"> [</span><br/><span class="hl-1">    {</span><br/><span class="hl-1">      </span><span class="hl-7">// after logger gets initialised as a resource, I&#39;m going to set the print threshold</span><br/><span class="hl-1">      </span><span class="hl-4">event:</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterInit</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">logger</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">; </span><span class="hl-7">// do not depend on the logger</span><br/><span class="hl-1">        </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">setPrintThreshold</span><span class="hl-1">(</span><span class="hl-2">&quot;trace&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The logger’s log() function is asynchronous because it handles events. If you want to prevent your system from waiting for log operations to complete, simply omit the await when calling log(). This is useful if you have listeners that send logs to external log storage systems.</p>
<p>Additionally, there is a <code>global.events.log</code> event available. You can use this event both to emit log messages and to listen for all log activities.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> { </span><span class="hl-6">logger</span><span class="hl-1"> } = </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">shipLogsToWarehouse</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.task.shipLogsToWarehouse&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">warehouseService:</span><span class="hl-1"> </span><span class="hl-4">warehouseServiceResource</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">log</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">; </span><span class="hl-7">// ILog</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1"> === </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1"> || </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1"> === </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-7">// Ensure no extra log() calls are made here to prevent infinite loops</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">deps</span><span class="hl-1">.</span><span class="hl-4">warehouseService</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">log</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>And yes, this would also work:</p>
<pre><code class="ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">task</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.task.logSomething&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">log:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">log</span><span class="hl-1"> }) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">log</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-2">&quot;info&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">anything:</span><span class="hl-1"> </span><span class="hl-2">&quot;you want&quot;</span><span class="hl-1"> };</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-4">context</span><span class="hl-1">: </span><span class="hl-2">&quot;app.task.logSomething&quot;</span><span class="hl-1">; </span><span class="hl-7">// optional</span><br/><span class="hl-1">    })</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Fair Warning: If you plan to use the global.events.log event, ensure you avoid creating a circular dependency. This event is emitted by the logger itself. Additionally, some logs are sent before all resources are fully initialized. Therefore, it’s important to carefully review and verify your dependencies to prevent potential issues.</p>
<a id="md:testing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Testing<a href="#md:testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Oh yes, testing is a breeze with this system. You can easily test your tasks, resources, and middleware by running them in a test environment. It's designed to be tested.</p>
<a id="md:unit-testing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Unit Testing<a href="#md:unit-testing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>You can easily test your middleware, resources and tasks by running them in a test environment.</p>
<p>The only components you need to test are the run function and the init functions, along with their proper dependencies.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorld</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">helloWorldResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.helloWorldResource&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// sample tests for the task</span><br/><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;app.helloWorld&quot;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">it</span><span class="hl-1">(</span><span class="hl-2">&quot;should return Hello World!&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">helloWorld</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">input</span><span class="hl-1">, </span><span class="hl-4">dependencies</span><span class="hl-1">); </span><span class="hl-7">// pass in the arguments and the mocked dependencies.</span><br/><span class="hl-1">    </span><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-7">// sample tests for the resource</span><br/><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;app.helloWorldResource&quot;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">it</span><span class="hl-1">(</span><span class="hl-2">&quot;should return Hello World!&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">helloWorldResource</span><span class="hl-1">.</span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">dependencies</span><span class="hl-1">); </span><span class="hl-7">// pass in the arguments and the mocked dependencies.</span><br/><span class="hl-1">    </span><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Integration<a href="#md:integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Unit testing becomes straightforward with mocks, as all dependencies are explicitly defined. However, if you wish to run an integration test, you can have a task tested within the full container environment.</p>
<pre><code class="ts"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1">, </span><span class="hl-4">global</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">task</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.myTask&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello World!&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">myTask</span><span class="hl-1">],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Then your tests can now be cleaner, as you can use <code>overrides</code> and a wrapper resource to mock your task.</p>
<pre><code class="ts"><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">it</span><span class="hl-1">(</span><span class="hl-2">&quot;an example to override a task or resource&quot;</span><span class="hl-1">, </span><span class="hl-5">async</span><span class="hl-1"> () </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">testApp</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.test&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">myApp</span><span class="hl-1">], </span><span class="hl-7">// wrap your existing app</span><br/><span class="hl-1">      </span><span class="hl-4">overrides:</span><span class="hl-1"> [</span><span class="hl-4">override</span><span class="hl-1">], </span><span class="hl-7">// apply the overrides for &quot;app.myTask&quot;</span><br/><span class="hl-1">      </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-7">// you can now test a task simply by depending on it, and running it, then asserting the response of run()</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">testApp</span><span class="hl-1">);</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Support<a href="#md:support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This package is part of the <a href="https://www.bluelibs.com" target="_blank" class="external">BlueLibs</a> family. If you enjoy this work, please show your support by starring <a href="https://github.com/bluelibs/runner" target="_blank" class="external">the main repository</a>.</p>
<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project is licensed under the MIT License - see the <a href="media/LICENSE.md">LICENSE.md</a> file for details.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:bluelibs-runner"><span>Blue<wbr/>Libs <wbr/>Runner</span></a><ul><li><a href="#md:building-blocks"><span>Building <wbr/>Blocks</span></a></li><li><a href="#md:installation"><span>Installation</span></a></li><li><a href="#md:basic-usage"><span>Basic <wbr/>Usage</span></a></li><li><a href="#md:resources-and-tasks"><span>Resources and <wbr/>Tasks</span></a></li><li><ul><li><a href="#md:when-to-use-each"><span>When to use each?</span></a></li><li><a href="#md:resource-dispose"><span>Resource dispose()</span></a></li><li><a href="#md:resource-configuration"><span>Resource configuration</span></a></li></ul></li><li><a href="#md:dependencies"><span>Dependencies</span></a></li><li><a href="#md:events"><span>Events</span></a></li><li><ul><li><a href="#md:taskon-property"><span>task.on property</span></a></li><li><a href="#md:resourcehooks-property"><span>resource.hooks property</span></a></li><li><ul><li><a href="#md:wildcard-events"><span>wildcard events</span></a></li></ul></li><li><a href="#md:when-to-use-either"><span>When to use either?</span></a></li></ul></li><li><a href="#md:middleware"><span>Middleware</span></a></li><li><ul><li><a href="#md:global"><span>Global</span></a></li></ul></li><li><a href="#md:errors"><span>Errors</span></a></li><li><a href="#md:meta"><span>Meta</span></a></li><li><a href="#md:internal-services"><span>Internal <wbr/>Services</span></a></li><li><a href="#md:namespacing"><span>Namespacing</span></a></li><li><a href="#md:real-life"><span>Real life</span></a></li><li><ul><li><a href="#md:business-config"><span>Business config</span></a></li></ul></li><li><a href="#md:global-events"><span>Global <wbr/>Events</span></a></li><li><ul><li><a href="#md:task-level"><span>Task level</span></a></li><li><a href="#md:resource-level"><span>Resource level</span></a></li></ul></li><li><a href="#md:advanced-usage"><span>Advanced <wbr/>Usage</span></a></li><li><ul><li><a href="#md:inter-communication-between-resources"><span>Inter-<wbr/>communication between resources</span></a></li><li><a href="#md:overrides"><span>Overrides</span></a></li></ul></li><li><a href="#md:logging"><span>Logging</span></a></li><li><ul><li><a href="#md:logs-summary-table"><span>Logs <wbr/>Summary <wbr/>Table</span></a></li><li><a href="#md:print-logs"><span>Print logs</span></a></li></ul></li><li><a href="#md:testing"><span>Testing</span></a></li><li><ul><li><a href="#md:unit-testing"><span>Unit <wbr/>Testing</span></a></li><li><a href="#md:integration"><span>Integration</span></a></li></ul></li><li><a href="#md:support"><span>Support</span></a></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@bluelibs/runner - v1.5.0</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div><script>
          try {
            const generateLinkElement = document.querySelector(".tsd-generator a");
            const link = document.createElement("a");
            Object.assign(link, {
              href: "https://github.com/dmnsgn/typedoc-material-theme",
              target: "_blank",
              rel: "noreferrer",
              innerText: "typedoc-material-theme."
            });
            generateLinkElement.insertAdjacentElement("afterend", link);
            generateLinkElement.insertAdjacentText("afterend", " with ");
          } catch (error) {

          }
        </script></body></html>
