<!DOCTYPE html><html class="default" lang="en"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@bluelibs/runner - v3.3.2</title><meta name="description" content="Documentation for @bluelibs/runner"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/icons.js" id="tsd-icons-script"></script><script async src="assets/search.js" id="tsd-search-script"></script><script async src="assets/navigation.js" id="tsd-nav-script"></script><style>
@media (prefers-color-scheme: dark) {
  :root {
    --md-sys-color-primary: #60d4fe;
    --md-sys-color-on-primary: #003545;
    --md-sys-color-primary-container: #004d62;
    --md-sys-color-on-primary-container: #bbe9ff;
    --md-sys-color-secondary: #b4cad5;
    --md-sys-color-on-secondary: #1e333c;
    --md-sys-color-secondary-container: #354a53;
    --md-sys-color-on-secondary-container: #cfe6f1;
    --md-sys-color-tertiary: #c5c3ea;
    --md-sys-color-on-tertiary: #2d2d4d;
    --md-sys-color-tertiary-container: #444465;
    --md-sys-color-on-tertiary-container: #e2dfff;
    --md-sys-color-error: #ffb4ab;
    --md-sys-color-on-error: #690005;
    --md-sys-color-error-container: #93000a;
    --md-sys-color-on-error-container: #ffb4ab;
    --md-sys-color-background: #191c1e;
    --md-sys-color-on-background: #e1e3e4;
    --md-sys-color-surface: #191c1e;
    --md-sys-color-on-surface: #e1e3e4;
    --md-sys-color-surface-variant: #40484c;
    --md-sys-color-on-surface-variant: #c0c8cc;
    --md-sys-color-outline: #8a9296;
    --md-sys-color-outline-variant: #40484c;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #e1e3e4;
    --md-sys-color-inverse-on-surface: #2e3132;
    --md-sys-color-inverse-primary: #006782;
    --md-sys-color-surface-dim: #111415;
    --md-sys-color-surface-bright: #373a3b;
    --md-sys-color-surface-container-lowest: #0c0f10;
    --md-sys-color-surface-container-low: #191c1e;
    --md-sys-color-surface-container: #1d2022;
    --md-sys-color-surface-container-high: #272a2c;
    --md-sys-color-surface-container-highest: #323537
  }
}
:root[data-theme="dark"] {
  --md-sys-color-primary: #60d4fe;
  --md-sys-color-on-primary: #003545;
  --md-sys-color-primary-container: #004d62;
  --md-sys-color-on-primary-container: #bbe9ff;
  --md-sys-color-secondary: #b4cad5;
  --md-sys-color-on-secondary: #1e333c;
  --md-sys-color-secondary-container: #354a53;
  --md-sys-color-on-secondary-container: #cfe6f1;
  --md-sys-color-tertiary: #c5c3ea;
  --md-sys-color-on-tertiary: #2d2d4d;
  --md-sys-color-tertiary-container: #444465;
  --md-sys-color-on-tertiary-container: #e2dfff;
  --md-sys-color-error: #ffb4ab;
  --md-sys-color-on-error: #690005;
  --md-sys-color-error-container: #93000a;
  --md-sys-color-on-error-container: #ffb4ab;
  --md-sys-color-background: #191c1e;
  --md-sys-color-on-background: #e1e3e4;
  --md-sys-color-surface: #191c1e;
  --md-sys-color-on-surface: #e1e3e4;
  --md-sys-color-surface-variant: #40484c;
  --md-sys-color-on-surface-variant: #c0c8cc;
  --md-sys-color-outline: #8a9296;
  --md-sys-color-outline-variant: #40484c;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #e1e3e4;
  --md-sys-color-inverse-on-surface: #2e3132;
  --md-sys-color-inverse-primary: #006782;
  --md-sys-color-surface-dim: #111415;
  --md-sys-color-surface-bright: #373a3b;
  --md-sys-color-surface-container-lowest: #0c0f10;
  --md-sys-color-surface-container-low: #191c1e;
  --md-sys-color-surface-container: #1d2022;
  --md-sys-color-surface-container-high: #272a2c;
  --md-sys-color-surface-container-highest: #323537
}

@media (prefers-color-scheme: light) {
  :root {
    --md-sys-color-primary: #006782;
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #bbe9ff;
    --md-sys-color-on-primary-container: #001f29;
    --md-sys-color-secondary: #4c616b;
    --md-sys-color-on-secondary: #ffffff;
    --md-sys-color-secondary-container: #cfe6f1;
    --md-sys-color-on-secondary-container: #071e26;
    --md-sys-color-tertiary: #5c5b7e;
    --md-sys-color-on-tertiary: #ffffff;
    --md-sys-color-tertiary-container: #e2dfff;
    --md-sys-color-on-tertiary-container: #181837;
    --md-sys-color-error: #ba1a1a;
    --md-sys-color-on-error: #ffffff;
    --md-sys-color-error-container: #ffdad6;
    --md-sys-color-on-error-container: #410002;
    --md-sys-color-background: #fbfcfe;
    --md-sys-color-on-background: #191c1e;
    --md-sys-color-surface: #fbfcfe;
    --md-sys-color-on-surface: #191c1e;
    --md-sys-color-surface-variant: #dce4e8;
    --md-sys-color-on-surface-variant: #40484c;
    --md-sys-color-outline: #70787d;
    --md-sys-color-outline-variant: #c0c8cc;
    --md-sys-color-shadow: #000000;
    --md-sys-color-scrim: #000000;
    --md-sys-color-inverse-surface: #2e3132;
    --md-sys-color-inverse-on-surface: #eff1f3;
    --md-sys-color-inverse-primary: #60d4fe;
    --md-sys-color-surface-dim: #d8dadc;
    --md-sys-color-surface-bright: #f8f9fb;
    --md-sys-color-surface-container-lowest: #ffffff;
    --md-sys-color-surface-container-low: #f2f4f5;
    --md-sys-color-surface-container: #edeef0;
    --md-sys-color-surface-container-high: #e7e8ea;
    --md-sys-color-surface-container-highest: #e1e3e4
  }
}
:root[data-theme="light"] {
  --md-sys-color-primary: #006782;
  --md-sys-color-on-primary: #ffffff;
  --md-sys-color-primary-container: #bbe9ff;
  --md-sys-color-on-primary-container: #001f29;
  --md-sys-color-secondary: #4c616b;
  --md-sys-color-on-secondary: #ffffff;
  --md-sys-color-secondary-container: #cfe6f1;
  --md-sys-color-on-secondary-container: #071e26;
  --md-sys-color-tertiary: #5c5b7e;
  --md-sys-color-on-tertiary: #ffffff;
  --md-sys-color-tertiary-container: #e2dfff;
  --md-sys-color-on-tertiary-container: #181837;
  --md-sys-color-error: #ba1a1a;
  --md-sys-color-on-error: #ffffff;
  --md-sys-color-error-container: #ffdad6;
  --md-sys-color-on-error-container: #410002;
  --md-sys-color-background: #fbfcfe;
  --md-sys-color-on-background: #191c1e;
  --md-sys-color-surface: #fbfcfe;
  --md-sys-color-on-surface: #191c1e;
  --md-sys-color-surface-variant: #dce4e8;
  --md-sys-color-on-surface-variant: #40484c;
  --md-sys-color-outline: #70787d;
  --md-sys-color-outline-variant: #c0c8cc;
  --md-sys-color-shadow: #000000;
  --md-sys-color-scrim: #000000;
  --md-sys-color-inverse-surface: #2e3132;
  --md-sys-color-inverse-on-surface: #eff1f3;
  --md-sys-color-inverse-primary: #60d4fe;
  --md-sys-color-surface-dim: #d8dadc;
  --md-sys-color-surface-bright: #f8f9fb;
  --md-sys-color-surface-container-lowest: #ffffff;
  --md-sys-color-surface-container-low: #f2f4f5;
  --md-sys-color-surface-container: #edeef0;
  --md-sys-color-surface-container-high: #e7e8ea;
  --md-sys-color-surface-container-highest: #e1e3e4
}
</style><link rel="stylesheet" href="assets/material-style.css"/></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-search"></use></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div><div class="field"><div id="tsd-toolbar-links"></div></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@bluelibs/runner - v3.3.2</a></div><div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><use href="assets/icons.svg#icon-menu"></use></svg></a></div></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><h2>@bluelibs/runner - v3.3.2</h2></div><div class="tsd-panel tsd-typography"><a id="md:bluelibs-runner-the-framework-that-actually-makes-sense" class="tsd-anchor"></a><h1 class="tsd-anchor-link">BlueLibs Runner: The Framework That Actually Makes Sense<a href="#md:bluelibs-runner-the-framework-that-actually-makes-sense" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h1><p><em>Or: How I Learned to Stop Worrying and Love Dependency Injection</em></p>
<p align="center">
<a href="https://github.com/bluelibs/runner/actions/workflows/ci.yml"><img src="https://github.com/bluelibs/runner/actions/workflows/ci.yml/badge.svg?branch=main" alt="Build Status" /></a>
<a href="https://coveralls.io/github/bluelibs/runner?branch=main"><img src="https://coveralls.io/repos/github/bluelibs/runner/badge.svg?branch=main" alt="Coverage Status" /></a>
<a href="https://bluelibs.github.io/runner/" target="_blank"><img src="https://img.shields.io/badge/read-typedocs-blue" alt="Docs" /></a>
<a href="https://github.com/bluelibs/runner" target="_blank"><img src="https://img.shields.io/badge/github-blue" alt="GitHub" /></a>
</p>
<ul>
<li><a href="https://bluelibs.github.io/runner/" target="_blank" class="external">View the documentation page here</a></li>
</ul>
<p>Welcome to BlueLibs Runner, where we've taken the chaos of modern application architecture and turned it into something that won't make you question your life choices at 3am. This isn't just another framework – it's your new best friend who actually understands that code should be readable, testable, and not require a PhD in abstract nonsense to maintain.</p>
<a id="md:what-is-this-thing" class="tsd-anchor"></a><h2 class="tsd-anchor-link">What Is This Thing?<a href="#md:what-is-this-thing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>BlueLibs Runner is a TypeScript-first framework that embraces functional programming principles while keeping dependency injection simple enough that you won't need a flowchart to understand your own code. Think of it as the anti-framework framework – it gets out of your way and lets you build stuff that actually works.</p>
<a id="md:the-core-philosophy-aka-why-we-built-this" class="tsd-anchor"></a><h3 class="tsd-anchor-link">The Core Philosophy (AKA Why We Built This)<a href="#md:the-core-philosophy-aka-why-we-built-this" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Tasks are functions</strong> - Not classes with 47 methods you'll never use</li>
<li><strong>Resources are singletons</strong> - Database connections, configs, services - the usual suspects</li>
<li><strong>Events are just events</strong> - Revolutionary concept, we know</li>
<li><strong>Everything is async</strong> - Because it's 2025 and blocking code is so 2005</li>
<li><strong>Explicit beats implicit</strong> - No magic, no surprises, no &quot;how the hell does this work?&quot;</li>
</ul>
<a id="md:quick-start-the-just-show-me-code-section" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Quick Start (The &quot;Just Show Me Code&quot; Section)<a href="#md:quick-start-the-just-show-me-code-section" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><pre><code class="bash"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">@bluelibs/runner</span>
</code><button type="button">Copy</button></pre>

<p>Here's a complete Express server in less lines than most frameworks need for their &quot;Hello World&quot;:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">express</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;express&quot;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">resource</span><span class="hl-1">, </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">run</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// A resource is anything you want to share across your app</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.server&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">: { </span><span class="hl-4">port</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">express</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">port</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Server running on port </span><span class="hl-6">${</span><span class="hl-4">config</span><span class="hl-9">.</span><span class="hl-4">port</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">app</span><span class="hl-1">, </span><span class="hl-4">server</span><span class="hl-1"> };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">dispose</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">server</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Tasks are your business logic - pure-ish, easily testable functions</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">createUser</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.createUser&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">server</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">: { </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }, { </span><span class="hl-4">server</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Your actual business logic here</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;user-123&quot;</span><span class="hl-1">, ...</span><span class="hl-4">userData</span><span class="hl-1"> };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Wire everything together</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// Here you make the system aware of resources, tasks, middleware, and events.</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-10">3000</span><span class="hl-1"> }), </span><span class="hl-4">createUser</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">server</span><span class="hl-1">, </span><span class="hl-4">createUser</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">server</span><span class="hl-1">, </span><span class="hl-4">createUser</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">post</span><span class="hl-1">(</span><span class="hl-2">&quot;/users&quot;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// That&#39;s it. No webpack configs, no decorators, no XML.</span><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">dispose</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:the-big-four-your-new-building-blocks" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Big Four: Your New Building Blocks<a href="#md:the-big-four-your-new-building-blocks" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:1-tasks-the-heart-of-your-business-logic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">1. Tasks: The Heart of Your Business Logic<a href="#md:1-tasks-the-heart-of-your-business-logic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tasks are functions with superpowers. They're pure-ish, testable, and composable. Unlike classes that accumulate methods like a hoarder accumulates stuff, tasks do one thing well.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sendEmail</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.sendEmail&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">emailService</span><span class="hl-1">, </span><span class="hl-4">logger</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">to</span><span class="hl-1">, </span><span class="hl-4">subject</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1"> }: </span><span class="hl-8">EmailData</span><span class="hl-1">, { </span><span class="hl-4">emailService</span><span class="hl-1">, </span><span class="hl-4">logger</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">`Sending email to </span><span class="hl-6">${</span><span class="hl-4">to</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">emailService</span><span class="hl-1">.</span><span class="hl-0">send</span><span class="hl-1">({ </span><span class="hl-4">to</span><span class="hl-1">, </span><span class="hl-4">subject</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Test it like a normal function (because it basically is)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sendEmail</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><br/><span class="hl-1">  { </span><span class="hl-4">to:</span><span class="hl-1"> </span><span class="hl-2">&quot;user@example.com&quot;</span><span class="hl-1">, </span><span class="hl-4">subject:</span><span class="hl-1"> </span><span class="hl-2">&quot;Hi&quot;</span><span class="hl-1">, </span><span class="hl-4">body:</span><span class="hl-1"> </span><span class="hl-2">&quot;Hello!&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">  { </span><span class="hl-4">emailService:</span><span class="hl-1"> </span><span class="hl-4">mockEmailService</span><span class="hl-1">, </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">mockLogger</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:when-to-task-and-when-not-to-task" class="tsd-anchor"></a><h4 class="tsd-anchor-link">When to Task and When Not to Task<a href="#md:when-to-task-and-when-not-to-task" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Look, we get it. You could turn every function into a task, but that's like using a sledgehammer to crack nuts. Here's the deal:</p>
<p><strong>Make it a task when:</strong></p>
<ul>
<li>It's a high-level business action: <code>&quot;app.user.register&quot;</code>, <code>&quot;app.order.process&quot;</code></li>
<li>You want it trackable and observable</li>
<li>Multiple parts of your app need it</li>
<li>It's complex enough to benefit from dependency injection</li>
</ul>
<p><strong>Don't make it a task when:</strong></p>
<ul>
<li>It's a simple utility function</li>
<li>It's used in only one place or to help other tasks</li>
<li>It's performance-critical and doesn't need DI overhead</li>
</ul>
<p>Think of tasks as the &quot;main characters&quot; in your application story, not every single line of dialogue.</p>
<a id="md:2-resources-your-singletons-that-dont-suck" class="tsd-anchor"></a><h3 class="tsd-anchor-link">2. Resources: Your Singletons That Don't Suck<a href="#md:2-resources-your-singletons-that-dont-suck" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Resources are the services, configs, and connections that live throughout your app's lifecycle. They initialize once and stick around until cleanup time. They have to be registered (via <code>register: []</code>) only once before they can be used.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">database</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.db&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MongoClient</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">DATABASE_URL</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-8">string</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">dispose</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">client</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userService</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.services.user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">database</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">database</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">: </span><span class="hl-8">UserData</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">database</span><span class="hl-1">.</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&quot;users&quot;</span><span class="hl-1">).</span><span class="hl-0">insertOne</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">);</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">getUser</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">database</span><span class="hl-1">.</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&quot;users&quot;</span><span class="hl-1">).</span><span class="hl-0">findOne</span><span class="hl-1">({ </span><span class="hl-4">_id:</span><span class="hl-1"> </span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:resource-configuration-because-hardcoding-is-for-amateurs" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Resource Configuration: Because Hardcoding Is for Amateurs<a href="#md:resource-configuration-because-hardcoding-is-for-amateurs" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Resources can be configured with type-safe options. No more &quot;config object of unknown shape&quot; nonsense.</p>
<pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-8">SMTPConfig</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">smtpUrl</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">from</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">emailer</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.emailer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">: </span><span class="hl-8">SMTPConfig</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-0">send</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">to</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-4">subject</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-4">body</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// Use config.smtpUrl and config.from</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Register with specific config</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-4">emailer</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">smtpUrl:</span><span class="hl-1"> </span><span class="hl-2">&quot;smtp://localhost&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">from:</span><span class="hl-1"> </span><span class="hl-2">&quot;noreply@myapp.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">    </span><span class="hl-5">// using emailer without with() will throw a type-error ;)</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:shared-context-between-init-and-dispose" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Shared Context Between Init and Dispose<a href="#md:shared-context-between-init-and-dispose" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>For cases where you need to share variables between <code>init()</code> and <code>dispose()</code> methods (because sometimes cleanup is complicated), use the enhanced context pattern:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">dbResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;db.service&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">context</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-4">connections:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Map</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-4">pools:</span><span class="hl-1"> [],</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">, </span><span class="hl-4">ctx</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">db</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">connectToDatabase</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">connections</span><span class="hl-1">.</span><span class="hl-0">set</span><span class="hl-1">(</span><span class="hl-2">&quot;main&quot;</span><span class="hl-1">, </span><span class="hl-4">db</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">pools</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-0">createPool</span><span class="hl-1">(</span><span class="hl-4">db</span><span class="hl-1">));</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">dispose</span><span class="hl-1">(</span><span class="hl-4">db</span><span class="hl-1">, </span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">, </span><span class="hl-4">ctx</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Same context available - no more &quot;how do I access that thing I created?&quot;</span><br/><span class="hl-1">    </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">pool</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">pools</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">pool</span><span class="hl-1">.</span><span class="hl-0">drain</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> [</span><span class="hl-7">name</span><span class="hl-1">, </span><span class="hl-7">conn</span><span class="hl-1">] </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">ctx</span><span class="hl-1">.</span><span class="hl-4">connections</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">conn</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">();</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:3-events-async-communication-that-actually-works" class="tsd-anchor"></a><h3 class="tsd-anchor-link">3. Events: Async Communication That Actually Works<a href="#md:3-events-async-communication-that-actually-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Events let different parts of your app talk to each other without tight coupling. It's like having a really good office messenger who never forgets anything.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userRegistered</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">email</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.events.userRegistered&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">registerUser</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.registerUser&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">userService</span><span class="hl-1">, </span><span class="hl-4">userRegistered</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">, { </span><span class="hl-4">userService</span><span class="hl-1">, </span><span class="hl-4">userRegistered</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">userService</span><span class="hl-1">.</span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Tell the world about it</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">userRegistered</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">email</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Someone else handles the welcome email</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sendWelcomeEmail</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.sendWelcomeEmail&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">userRegistered</span><span class="hl-1">, </span><span class="hl-5">// Listen to the event, notice the &quot;on&quot;</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">eventData</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Everything is type-safe, automatically inferred from the &#39;on&#39; property</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Welcome email sent to </span><span class="hl-6">${</span><span class="hl-4">eventData</span><span class="hl-9">.</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">email</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:wildcard-events-for-when-you-want-to-know-everything" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Wildcard Events: For When You Want to Know Everything<a href="#md:wildcard-events-for-when-you-want-to-know-everything" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Sometimes you need to be the nosy neighbor of your application:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logAllEventsTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.logAllEvents&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-2">&quot;*&quot;</span><span class="hl-1">, </span><span class="hl-5">// Listen to EVERYTHING</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Event detected&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Note: Be careful with dependencies here since some events fire before initialization</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:tasks-and-resources-built-in-events" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Tasks and Resources built-in events<a href="#md:tasks-and-resources-built-in-events" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Tasks and resources have their own lifecycle events that you can hook into:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">myTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({ ... });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">myResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({ ... });</span>
</code><button type="button">Copy</button></pre>

<ul>
<li><code>myTask.events.beforeRun</code> - Fires before the task runs</li>
<li><code>myTask.events.afterRun</code> - Fires after the task completes</li>
<li><code>myTask.events.onError</code> - Fires when the task fails</li>
<li><code>myResource.events.beforeInit</code> - Fires before the resource initializes</li>
<li><code>myResource.events.afterInit</code> - Fires after the resource initializes</li>
<li><code>myResource.events.onError</code> - Fires when the resource initialization fails</li>
</ul>
<p>Each event has its own utilities and functions.</p>
<a id="md:global-events-the-systems-built-in-gossip-network" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Global Events: The System's Built-in Gossip Network<a href="#md:global-events-the-systems-built-in-gossip-network" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The framework comes with its own set of events that fire during the lifecycle. Think of them as the system's way of keeping you informed:</p>
<ul>
<li><code>globals.tasks.beforeRun</code> - &quot;Hey, I'm about to run this task&quot;</li>
<li><code>globals.tasks.afterRun</code> - &quot;Task completed, here's what happened&quot;</li>
<li><code>globals.tasks.onError</code> - &quot;Oops, something went wrong&quot;</li>
<li><code>globals.resources.beforeInit</code> - &quot;Initializing a resource&quot;</li>
<li><code>globals.resources.afterInit</code> - &quot;Resource is ready&quot;</li>
<li><code>globals.resources.onError</code> - &quot;Resource initialization failed&quot;</li>
</ul>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">taskLogger</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.logging.taskLogger&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">globalEvents</span><span class="hl-1">.</span><span class="hl-4">tasks</span><span class="hl-1">.</span><span class="hl-4">beforeRun</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Running task: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">source</span><span class="hl-6">}</span><span class="hl-2"> with input:`</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:event-propagation-control-with-stoppropagation" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Event Propagation Control with stopPropagation()<a href="#md:event-propagation-control-with-stoppropagation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Sometimes you need to prevent other event listeners from processing an event. The <code>stopPropagation()</code> method gives you fine-grained control over event flow:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">criticalAlert</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-4">severity</span><span class="hl-1">: </span><span class="hl-2">&quot;low&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;medium&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;high&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">}&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.events.alert&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;System Alert Event&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Emitted when system issues are detected&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;monitoring&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;alerts&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// High-priority handler that can stop propagation</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">emergencyHandler</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.emergencyHandler&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">criticalAlert</span><span class="hl-1">, </span><span class="hl-5">// Works with global events too</span><br/><span class="hl-1">  </span><span class="hl-4">listenerOrder:</span><span class="hl-1"> -</span><span class="hl-10">100</span><span class="hl-1">, </span><span class="hl-5">// Higher priority (lower numbers run first)</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Alert received: </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">severity</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">severity</span><span class="hl-1"> === </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;🚨 CRITICAL ALERT - Activating emergency protocols&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">      </span><span class="hl-5">// Stop other handlers from running</span><br/><span class="hl-1">      </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-0">stopPropagation</span><span class="hl-1">();</span><br/><span class="hl-1">      </span><span class="hl-5">// Notify the on-call team, escalate, etc.</span><br/><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;🛑 Event propagation stopped - emergency protocols active&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:4-middleware-the-interceptor-pattern-done-right" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Middleware: The Interceptor Pattern Done Right<a href="#md:4-middleware-the-interceptor-pattern-done-right" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Middleware wraps around your tasks and resources, adding cross-cutting concerns without polluting your business logic.</p>
<pre><code class="typescript"><span class="hl-5">// This is a middleware that accepts a config</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">authMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.auth&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// You can also add dependencies, no problem.</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><br/><span class="hl-1">    { </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> },</span><br/><span class="hl-1">    </span><span class="hl-4">dependencies</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">config</span><span class="hl-1">: { </span><span class="hl-4">requiredRole</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }</span><br/><span class="hl-1">  ) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">.</span><span class="hl-4">user</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (!</span><span class="hl-4">user</span><span class="hl-1"> || </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">role</span><span class="hl-1"> !== </span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">requiredRole</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Unauthorized&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adminTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.adminOnly&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// If the configuration accepts {} or is empty, .with() becomes optional, otherwise it becomes enforced.</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><span class="hl-4">authMiddleware</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">requiredRole:</span><span class="hl-1"> </span><span class="hl-2">&quot;admin&quot;</span><span class="hl-1"> })],</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">: { </span><span class="hl-4">user</span><span class="hl-1">: </span><span class="hl-8">User</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Secret admin data&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:global-middleware-apply-everywhere-configure-once" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Global Middleware: Apply Everywhere, Configure Once<a href="#md:global-middleware-apply-everywhere-configure-once" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Want to add logging to everything? Authentication to all tasks? Global middleware has your back:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.log&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Executing: </span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Completed: </span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-4">logMiddleware</span><span class="hl-1">.</span><span class="hl-0">everywhere</span><span class="hl-1">({ </span><span class="hl-4">tasks:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-4">resources:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1"> }), </span><span class="hl-5">// Only tasks get logged</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:context-request-scoped-data-that-doesnt-drive-you-insane" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Context: Request-Scoped Data That Doesn't Drive You Insane<a href="#md:context-request-scoped-data-that-doesnt-drive-you-insane" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Ever tried to pass user data through 15 function calls? Yeah, we've been there. Context fixes that without turning your code into a game of telephone.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">UserContext</span><span class="hl-1"> = </span><span class="hl-0">createContext</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">role</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;(</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;app.userContext&quot;</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">getUserData</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.getUserData&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><span class="hl-4">UserContext</span><span class="hl-1">.</span><span class="hl-0">require</span><span class="hl-1">()], </span><span class="hl-5">// This is a middleware that ensures the context is available before task runs, throws if not.</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-4">UserContext</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(); </span><span class="hl-5">// Available anywhere in the async chain</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`Current user: </span><span class="hl-6">${</span><span class="hl-4">user</span><span class="hl-9">.</span><span class="hl-4">userId</span><span class="hl-6">}</span><span class="hl-2"> (</span><span class="hl-6">${</span><span class="hl-4">user</span><span class="hl-9">.</span><span class="hl-4">role</span><span class="hl-6">}</span><span class="hl-2">)`</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Provide context at the entry point</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handleRequest</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.requestHandler&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">UserContext</span><span class="hl-1">.</span><span class="hl-0">provide</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-2">&quot;123&quot;</span><span class="hl-1">, </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-2">&quot;admin&quot;</span><span class="hl-1"> }, </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">// All tasks called within this scope have access to UserContext</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getUserData</span><span class="hl-1">();</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:context-with-middleware-the-power-couple" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context with Middleware: The Power Couple<a href="#md:context-with-middleware-the-power-couple" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Context shines when combined with middleware for request-scoped data:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">RequestContext</span><span class="hl-1"> = </span><span class="hl-0">createContext</span><span class="hl-1">&lt;{</span><br/><span class="hl-1">  </span><span class="hl-4">requestId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">startTime</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">userAgent</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">}&gt;(</span><span class="hl-2">&quot;app.requestContext&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">requestMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.request&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// This works even in express middleware if needed.</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">provide</span><span class="hl-1">(</span><br/><span class="hl-1">      {</span><br/><span class="hl-1">        </span><span class="hl-4">requestId:</span><span class="hl-1"> </span><span class="hl-4">crypto</span><span class="hl-1">.</span><span class="hl-0">randomUUID</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-4">startTime:</span><span class="hl-1"> </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-4">userAgent:</span><span class="hl-1"> </span><span class="hl-2">&quot;MyApp/1.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">handleRequest</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.handleRequest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><span class="hl-4">requestMiddleware</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">: { </span><span class="hl-4">path</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">request</span><span class="hl-1"> = </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processing </span><span class="hl-6">${</span><span class="hl-4">input</span><span class="hl-9">.</span><span class="hl-4">path</span><span class="hl-6">}</span><span class="hl-2"> (Request ID: </span><span class="hl-6">${</span><span class="hl-4">request</span><span class="hl-9">.</span><span class="hl-4">requestId</span><span class="hl-6">}</span><span class="hl-2">)`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-4">requestId:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">requestId</span><span class="hl-1"> };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:dependency-management-the-index-pattern" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Dependency Management: The Index Pattern<a href="#md:dependency-management-the-index-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>When your app grows beyond &quot;hello world&quot;, you'll want to group related dependencies. The <code>index()</code> helper is your friend - it's basically a 3-in-1 resource that registers, depends on, and returns everything you give it.</p>
<pre><code class="typescript"><span class="hl-5">// This registers all services, depends on them, and returns them as one clean interface</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">services</span><span class="hl-1"> = </span><span class="hl-0">index</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">userService</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">emailService</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">paymentService</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">notificationService</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">services</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">services</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">services</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Access everything through one clean interface</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-4">userService</span><span class="hl-1">.</span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-4">emailService</span><span class="hl-1">.</span><span class="hl-0">sendWelcome</span><span class="hl-1">(</span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">email</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:error-handling-graceful-failures" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Error Handling: Graceful Failures<a href="#md:error-handling-graceful-failures" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Errors happen. When they do, you can listen for them and decide what to do. No more unhandled promise rejections ruining your day.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">riskyTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.risky&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Something went wrong&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// Behind the scenes when you create a task() we create these 3 events for you (onError, beforeRun, afterRun)</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">errorHandler</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.errorHandler&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">riskyTask</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">onError</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Task failed:&quot;</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Don&#39;t let the error bubble up - this makes the task return undefined</span><br/><span class="hl-1">    </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-0">suppress</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:caching-built-in-performance" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Caching: Built-in Performance<a href="#md:caching-built-in-performance" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Because nobody likes waiting for the same expensive operation twice:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">expensiveTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.expensive&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">middleware</span><span class="hl-1">.</span><span class="hl-4">cache</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-5">// lru-cache options by default</span><br/><span class="hl-1">      </span><span class="hl-4">ttl:</span><span class="hl-1"> </span><span class="hl-10">60</span><span class="hl-1"> * </span><span class="hl-10">1000</span><span class="hl-1">, </span><span class="hl-5">// Cache for 1 minute</span><br/><span class="hl-1">      </span><span class="hl-0">keyBuilder</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">taskId</span><span class="hl-1">, </span><span class="hl-4">input</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">`</span><span class="hl-6">${</span><span class="hl-4">taskId</span><span class="hl-6">}</span><span class="hl-2">-</span><span class="hl-6">${</span><span class="hl-4">input</span><span class="hl-9">.</span><span class="hl-4">userId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">, </span><span class="hl-5">// optional key builder</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">userId</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// This expensive operation will be cached</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">doExpensiveCalculation</span><span class="hl-1">(</span><span class="hl-4">userId</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Global cache configuration</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.cache&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">// You have to register it, cache resource is not enabled by default.</span><br/><span class="hl-1">    </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">cache</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">defaultOptions:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">max:</span><span class="hl-1"> </span><span class="hl-10">1000</span><span class="hl-1">, </span><span class="hl-5">// Maximum items in cache</span><br/><span class="hl-1">        </span><span class="hl-4">ttl:</span><span class="hl-1"> </span><span class="hl-10">30</span><span class="hl-1"> * </span><span class="hl-10">1000</span><span class="hl-1">, </span><span class="hl-5">// Default TTL</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      </span><span class="hl-4">async:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">, </span><span class="hl-5">// in-memory is sync by default</span><br/><span class="hl-1">      </span><span class="hl-5">// When using redis or others mark this as true to await response.</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Want Redis instead of the default LRU cache? No problem, just override the cache factory task:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">task</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">redisCacheFactory</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;globals.tasks.cacheFactory&quot;</span><span class="hl-1">, </span><span class="hl-5">// Same ID as the default task</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">options</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">RedisCache</span><span class="hl-1">(</span><span class="hl-4">options</span><span class="hl-1">); </span><span class="hl-5">// Make sure to turn async on in the cacher.</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">// Your other stuff</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-4">overrides:</span><span class="hl-1"> [</span><span class="hl-4">redisCacheFactory</span><span class="hl-1">], </span><span class="hl-5">// Override the default cache factory</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:retrying-failed-operations" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Retrying Failed Operations<a href="#md:retrying-failed-operations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>For when things go wrong, but you know they'll probably work if you just try again. The built-in retry middleware makes your tasks and resources more resilient to transient failures.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">flakyApiCall</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.flakyApiCall&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">middleware</span><span class="hl-1">.</span><span class="hl-4">retry</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">retries:</span><span class="hl-1"> </span><span class="hl-10">5</span><span class="hl-1">, </span><span class="hl-5">// Try up to 5 times</span><br/><span class="hl-1">      </span><span class="hl-0">delayStrategy</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">attempt</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">100</span><span class="hl-1"> * </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">pow</span><span class="hl-1">(</span><span class="hl-10">2</span><span class="hl-1">, </span><span class="hl-4">attempt</span><span class="hl-1">), </span><span class="hl-5">// Exponential backoff</span><br/><span class="hl-1">      </span><span class="hl-0">stopRetryIf</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> === </span><span class="hl-2">&quot;Invalid credentials&quot;</span><span class="hl-1">, </span><span class="hl-5">// Don&#39;t retry auth errors</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// This might fail due to network issues, rate limiting, etc.</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchFromUnreliableService</span><span class="hl-1">();</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">flakyApiCall</span><span class="hl-1">],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The retry middleware can be configured with:</p>
<ul>
<li><code>retries</code>: The maximum number of retry attempts (default: 3).</li>
<li><code>delayStrategy</code>: A function that returns the delay in milliseconds before the next attempt.</li>
<li><code>stopRetryIf</code>: A function to prevent retries for certain types of errors.</li>
</ul>
<a id="md:logging-because-consolelog-isnt-professional" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Logging: Because Console.log Isn't Professional<a href="#md:logging-because-consolelog-isnt-professional" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><em>The structured logging system that actually makes debugging enjoyable</em></p>
<p>BlueLibs Runner comes with a built-in logging system that's event-driven, structured, and doesn't make you hate your life when you're trying to debug at 2 AM. It emits events for everything, so you can handle logs however you want - ship them to your favorite log warehouse, pretty-print them to console, or ignore them entirely (we won't judge).</p>
<a id="md:quick-start-basic-logging" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Quick Start: Basic Logging<a href="#md:quick-start-basic-logging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">businessTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.business&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">logger</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Starting business process&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;This might take a while&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Oops, something went wrong&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Database connection failed&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">critical</span><span class="hl-1">(</span><span class="hl-2">&quot;System is on fire&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">temperature:</span><span class="hl-1"> </span><span class="hl-2">&quot;9000°C&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:log-levels-from-whispers-to-screams" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Log Levels: From Whispers to Screams<a href="#md:log-levels-from-whispers-to-screams" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The logger supports six log levels with increasing severity:</p>
<table>
<thead>
<tr>
<th>Level</th>
<th>Severity</th>
<th>When to Use</th>
<th>Color</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>trace</code></td>
<td>0</td>
<td>Ultra-detailed debugging info</td>
<td>Gray</td>
</tr>
<tr>
<td><code>debug</code></td>
<td>1</td>
<td>Development and debugging information</td>
<td>Cyan</td>
</tr>
<tr>
<td><code>info</code></td>
<td>2</td>
<td>General information about normal operations</td>
<td>Green</td>
</tr>
<tr>
<td><code>warn</code></td>
<td>3</td>
<td>Something's not right, but still working</td>
<td>Yellow</td>
</tr>
<tr>
<td><code>error</code></td>
<td>4</td>
<td>Errors that need attention</td>
<td>Red</td>
</tr>
<tr>
<td><code>critical</code></td>
<td>5</td>
<td>System-threatening issues</td>
<td>Magenta</td>
</tr>
</tbody>
</table>
<pre><code class="typescript"><span class="hl-5">// All log levels are available as methods</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">trace</span><span class="hl-1">(</span><span class="hl-2">&quot;Ultra-detailed debugging info&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">&quot;Development debugging&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Normal operation&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;Something&#39;s fishy&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Houston, we have a problem&quot;</span><span class="hl-1">);</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">critical</span><span class="hl-1">(</span><span class="hl-2">&quot;DEFCON 1: Everything is broken&quot;</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:structured-logging-more-than-just-strings" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Structured Logging: More Than Just Strings<a href="#md:structured-logging-more-than-just-strings" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The logger accepts rich, structured data that makes debugging actually useful:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.user.create&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">, { </span><span class="hl-4">logger</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Basic message</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Creating new user&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// With structured data</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;User creation attempt&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-4">userData</span><span class="hl-1">.</span><span class="hl-4">email</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">registrationSource:</span><span class="hl-1"> </span><span class="hl-2">&quot;web&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">().</span><span class="hl-0">toISOString</span><span class="hl-1">(),</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// With error information</span><br/><span class="hl-1">    </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;User created successfully&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">email</span><span class="hl-1"> },</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;User creation failed&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">        </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">attemptedEmail:</span><span class="hl-1"> </span><span class="hl-4">userData</span><span class="hl-1">.</span><span class="hl-4">email</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">validationErrors:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">validationErrors</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:context-aware-logging-the-with-method" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Context-Aware Logging: The with() Method<a href="#md:context-aware-logging-the-with-method" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Create logger instances with bound context for consistent metadata across related operations:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">RequestContext</span><span class="hl-1"> = </span><span class="hl-0">createContext</span><span class="hl-1">&lt;{ </span><span class="hl-4">requestId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;(</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;app.requestContext&quot;</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">requestHandler</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.handleRequest&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">logger:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">requestData</span><span class="hl-1">, { </span><span class="hl-4">logger</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">request</span><span class="hl-1"> = </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Create a contextual logger with bound metadata</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">requestLogger</span><span class="hl-1"> = </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">requestId:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">requestId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">request</span><span class="hl-1">.</span><span class="hl-4">userId</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-2">&quot;api.handler&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// All logs from this logger will include the bound context</span><br/><span class="hl-1">    </span><span class="hl-4">requestLogger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Processing request&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">endpoint:</span><span class="hl-1"> </span><span class="hl-4">requestData</span><span class="hl-1">.</span><span class="hl-4">path</span><span class="hl-1"> },</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">requestLogger</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">&quot;Validating input&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">inputSize:</span><span class="hl-1"> </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><span class="hl-4">requestData</span><span class="hl-1">).</span><span class="hl-4">length</span><span class="hl-1"> },</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Context is automatically included in all log events</span><br/><span class="hl-1">    </span><span class="hl-4">requestLogger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Request processing failed&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Invalid input&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">stage:</span><span class="hl-1"> </span><span class="hl-2">&quot;validation&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:print-threshold-control-what-shows-up" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Print Threshold: Control What Shows Up<a href="#md:print-threshold-control-what-shows-up" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>By default, logs are just events - they don't print to console unless you tell them to. Set a print threshold to automatically output logs at or above a certain level:</p>
<pre><code class="typescript"><span class="hl-5">// Set up log printing (they don&#39;t print by default)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">setupLogging</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.logging.setup&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">afterInit</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logger</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">.</span><span class="hl-4">value</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Print info level and above (info, warn, error, critical)</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">setPrintThreshold</span><span class="hl-1">(</span><span class="hl-2">&quot;info&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Print only errors and critical issues</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">setPrintThreshold</span><span class="hl-1">(</span><span class="hl-2">&quot;error&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Disable auto-printing entirely</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">setPrintThreshold</span><span class="hl-1">(</span><span class="hl-6">null</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:event-driven-log-handling-ship-logs-anywhere" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Event-Driven Log Handling: Ship Logs Anywhere<a href="#md:event-driven-log-handling-ship-logs-anywhere" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every log generates an event that you can listen to. This is where the real power comes in:</p>
<pre><code class="typescript"><span class="hl-5">// Ship logs to your favorite log warehouse</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">logShipper</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.logging.shipper&quot;</span><span class="hl-1">, </span><span class="hl-5">// or pretty printer, or winston, pino bridge, etc.</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">log</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Ship critical errors to PagerDuty</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1"> === </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">pagerDuty</span><span class="hl-1">.</span><span class="hl-0">alert</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">details:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Ship all errors to error tracking</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1"> === </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1"> || </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1"> === </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">sentry</span><span class="hl-1">.</span><span class="hl-0">captureException</span><span class="hl-1">(</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1"> || </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">), {</span><br/><span class="hl-1">        </span><span class="hl-4">tags:</span><span class="hl-1"> { </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1"> },</span><br/><span class="hl-1">        </span><span class="hl-4">extra:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Ship everything to your log warehouse</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logWarehouse</span><span class="hl-1">.</span><span class="hl-0">ship</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">context:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Filter logs by source</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">databaseLogHandler</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.logging.database&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">log</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Only handle database-related logs</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1">?.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&quot;database&quot;</span><span class="hl-1">)) {</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">databaseMonitoring</span><span class="hl-1">.</span><span class="hl-0">recordMetric</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">operation:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">?.</span><span class="hl-4">operation</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">duration:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">?.</span><span class="hl-4">duration</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1">,</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:integration-with-winston-best-of-both-worlds" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Integration with Winston: Best of Both Worlds<a href="#md:integration-with-winston-best-of-both-worlds" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Want to use Winston as your transport? No problem - integrate it seamlessly:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">winston</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;winston&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Create Winston logger, put it in a resource if used from various places.</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winstonLogger</span><span class="hl-1"> = </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-0">createLogger</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-2">&quot;info&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">format:</span><span class="hl-1"> </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">format</span><span class="hl-1">.</span><span class="hl-0">combine</span><span class="hl-1">(</span><br/><span class="hl-1">    </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">format</span><span class="hl-1">.</span><span class="hl-0">timestamp</span><span class="hl-1">(),</span><br/><span class="hl-1">    </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">format</span><span class="hl-1">.</span><span class="hl-0">errors</span><span class="hl-1">({ </span><span class="hl-4">stack:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">format</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">()</span><br/><span class="hl-1">  ),</span><br/><span class="hl-1">  </span><span class="hl-4">transports:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">transports</span><span class="hl-1">.</span><span class="hl-0">File</span><span class="hl-1">({ </span><span class="hl-4">filename:</span><span class="hl-1"> </span><span class="hl-2">&quot;error.log&quot;</span><span class="hl-1">, </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">transports</span><span class="hl-1">.</span><span class="hl-0">File</span><span class="hl-1">({ </span><span class="hl-4">filename:</span><span class="hl-1"> </span><span class="hl-2">&quot;combined.log&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">    </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">transports</span><span class="hl-1">.</span><span class="hl-0">Console</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">format:</span><span class="hl-1"> </span><span class="hl-4">winston</span><span class="hl-1">.</span><span class="hl-4">format</span><span class="hl-1">.</span><span class="hl-0">simple</span><span class="hl-1">(),</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Bridge BlueLibs logs to Winston</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winstonBridge</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.logging.winston&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">events</span><span class="hl-1">.</span><span class="hl-4">log</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">log</span><span class="hl-1"> = </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">;</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Convert BlueLibs log to Winston format</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winstonMeta</span><span class="hl-1"> = {</span><br/><span class="hl-1">      </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">data:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">context:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">,</span><br/><span class="hl-1">      ...(</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1"> &amp;&amp; { </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1"> }),</span><br/><span class="hl-1">    };</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Map log levels (BlueLibs -&gt; Winston)</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">levelMapping</span><span class="hl-1"> = {</span><br/><span class="hl-1">      </span><span class="hl-4">trace:</span><span class="hl-1"> </span><span class="hl-2">&quot;silly&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">debug:</span><span class="hl-1"> </span><span class="hl-2">&quot;debug&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">info:</span><span class="hl-1"> </span><span class="hl-2">&quot;info&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">warn:</span><span class="hl-1"> </span><span class="hl-2">&quot;warn&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">critical:</span><span class="hl-1"> </span><span class="hl-2">&quot;error&quot;</span><span class="hl-1">, </span><span class="hl-5">// Winston doesn&#39;t have critical, use error</span><br/><span class="hl-1">    };</span><br/><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">winstonLevel</span><span class="hl-1"> = </span><span class="hl-4">levelMapping</span><span class="hl-1">[</span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1">] || </span><span class="hl-2">&quot;info&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">winstonLogger</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">winstonLevel</span><span class="hl-1">, </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">, </span><span class="hl-4">winstonMeta</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:advanced-custom-log-formatters" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Advanced: Custom Log Formatters<a href="#md:advanced-custom-log-formatters" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Want to customize how logs are printed? You can override the print behavior:</p>
<pre><code class="typescript"><span class="hl-5">// Custom logger with JSON output</span><br/><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">JSONLogger</span><span class="hl-1"> </span><span class="hl-6">extends</span><span class="hl-1"> </span><span class="hl-8">Logger</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">print</span><span class="hl-1">(</span><span class="hl-4">log</span><span class="hl-1">: </span><span class="hl-8">ILog</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-7">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">(</span><br/><span class="hl-1">        {</span><br/><span class="hl-1">          </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">timestamp</span><span class="hl-1">.</span><span class="hl-0">toISOString</span><span class="hl-1">(),</span><br/><span class="hl-1">          </span><span class="hl-4">level:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">level</span><span class="hl-1">.</span><span class="hl-0">toUpperCase</span><span class="hl-1">(),</span><br/><span class="hl-1">          </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">source</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">message:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">data:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">context:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">context</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">log</span><span class="hl-1">.</span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">        </span><span class="hl-6">null</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-10">2</span><br/><span class="hl-1">      )</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Custom logger resource</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">customLogger</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.logger.custom&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">eventManager:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">eventManager</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">eventManager</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">JSONLogger</span><span class="hl-1">(</span><span class="hl-4">eventManager</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Or you could simply add it as &quot;globals.resources.logger&quot; and override the default logger</span>
</code><button type="button">Copy</button></pre>

<a id="md:log-structure-what-you-get" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Log Structure: What You Get<a href="#md:log-structure-what-you-get" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every log event contains:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">ILog</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">level</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// The log level (trace, debug, info, etc.)</span><br/><span class="hl-1">  </span><span class="hl-4">source</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// Where the log came from</span><br/><span class="hl-1">  </span><span class="hl-4">message</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">; </span><span class="hl-5">// The main log message (can be object or string)</span><br/><span class="hl-1">  </span><span class="hl-4">timestamp</span><span class="hl-1">: </span><span class="hl-8">Date</span><span class="hl-1">; </span><span class="hl-5">// When the log was created</span><br/><span class="hl-1">  </span><span class="hl-4">error</span><span class="hl-1">?: {</span><br/><span class="hl-1">    </span><span class="hl-5">// Structured error information</span><br/><span class="hl-1">    </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">message</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">stack</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">  };</span><br/><span class="hl-1">  </span><span class="hl-4">data</span><span class="hl-1">?: </span><span class="hl-8">Record</span><span class="hl-1">&lt;</span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-8">any</span><span class="hl-1">&gt;; </span><span class="hl-5">// Additional structured data, it&#39;s about the log itself</span><br/><span class="hl-1">  </span><span class="hl-4">context</span><span class="hl-1">?: </span><span class="hl-8">Record</span><span class="hl-1">&lt;</span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-8">any</span><span class="hl-1">&gt;; </span><span class="hl-5">// Bound context from logger.with(), it&#39;s about the context in which the log was created</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:debugging-tips--best-practices" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Debugging Tips &amp; Best Practices<a href="#md:debugging-tips--best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="md:1-use-structured-data-liberally" class="tsd-anchor"></a><h4 class="tsd-anchor-link">1. Use Structured Data Liberally<a href="#md:1-use-structured-data-liberally" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-5">// Bad - hard to search and filter</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">`Failed to process user </span><span class="hl-6">${</span><span class="hl-4">userId</span><span class="hl-6">}</span><span class="hl-2"> order </span><span class="hl-6">${</span><span class="hl-4">orderId</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Good - searchable and filterable</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Order processing failed&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">userId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">orderId</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">step:</span><span class="hl-1"> </span><span class="hl-2">&quot;payment&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">paymentMethod:</span><span class="hl-1"> </span><span class="hl-2">&quot;credit_card&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:2-include-context-in-errors" class="tsd-anchor"></a><h4 class="tsd-anchor-link">2. Include Context in Errors<a href="#md:2-include-context-in-errors" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-5">// Include relevant context with errors</span><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">processPayment</span><span class="hl-1">(</span><span class="hl-4">order</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Payment processing failed&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">data:</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">orderId:</span><span class="hl-1"> </span><span class="hl-4">order</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">amount:</span><span class="hl-1"> </span><span class="hl-4">order</span><span class="hl-1">.</span><span class="hl-4">total</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">currency:</span><span class="hl-1"> </span><span class="hl-4">order</span><span class="hl-1">.</span><span class="hl-4">currency</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">paymentMethod:</span><span class="hl-1"> </span><span class="hl-4">order</span><span class="hl-1">.</span><span class="hl-4">paymentMethod</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">attemptNumber:</span><span class="hl-1"> </span><span class="hl-4">order</span><span class="hl-1">.</span><span class="hl-4">paymentAttempts</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:3-use-different-log-levels-appropriately" class="tsd-anchor"></a><h4 class="tsd-anchor-link">3. Use Different Log Levels Appropriately<a href="#md:3-use-different-log-levels-appropriately" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-5">// Good level usage</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">debug</span><span class="hl-1">(</span><span class="hl-2">&quot;Cache hit&quot;</span><span class="hl-1">, { </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">key</span><span class="hl-1">, </span><span class="hl-4">ttl:</span><span class="hl-1"> </span><span class="hl-4">remainingTTL</span><span class="hl-1"> } });</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;User logged in&quot;</span><span class="hl-1">, { </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">userId</span><span class="hl-1">, </span><span class="hl-4">loginMethod</span><span class="hl-1"> } });</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;Rate limit approaching&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">current:</span><span class="hl-1"> </span><span class="hl-10">95</span><span class="hl-1">, </span><span class="hl-4">limit:</span><span class="hl-1"> </span><span class="hl-10">100</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&quot;Database connection failed&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">error</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">attempt:</span><span class="hl-1"> </span><span class="hl-10">3</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">critical</span><span class="hl-1">(</span><span class="hl-2">&quot;System out of memory&quot;</span><span class="hl-1">, { </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">available:</span><span class="hl-1"> </span><span class="hl-2">&quot;0MB&quot;</span><span class="hl-1"> } });</span>
</code><button type="button">Copy</button></pre>

<a id="md:4-create-domain-specific-loggers" class="tsd-anchor"></a><h4 class="tsd-anchor-link">4. Create Domain-Specific Loggers<a href="#md:4-create-domain-specific-loggers" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-5">// Create loggers with domain context</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">paymentLogger</span><span class="hl-1"> = </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-2">&quot;payment.processor&quot;</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">authLogger</span><span class="hl-1"> = </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-2">&quot;auth.service&quot;</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">emailLogger</span><span class="hl-1"> = </span><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">source:</span><span class="hl-1"> </span><span class="hl-2">&quot;email.service&quot;</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Use throughout your domain</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">paymentLogger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Processing payment&quot;</span><span class="hl-1">, { </span><span class="hl-4">data:</span><span class="hl-1"> </span><span class="hl-4">paymentData</span><span class="hl-1"> });</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">authLogger</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">&quot;Failed login attempt&quot;</span><span class="hl-1">, { </span><span class="hl-4">data:</span><span class="hl-1"> { </span><span class="hl-4">email</span><span class="hl-1">, </span><span class="hl-4">ip</span><span class="hl-1"> } });</span>
</code><button type="button">Copy</button></pre>

<a id="md:meta-documenting-and-organizing-your-components" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Meta: Documenting and Organizing Your Components<a href="#md:meta-documenting-and-organizing-your-components" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><em>The structured way to describe what your components do and control their behavior</em></p>
<p>Metadata in BlueLibs Runner provides a systematic way to document, categorize, and control the behavior of your tasks, resources, events, and middleware. Think of it as your component's passport - it tells you and your tools everything they need to know about what this component does and how it should be treated.</p>
<a id="md:basic-metadata-properties" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Metadata Properties<a href="#md:basic-metadata-properties" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Every component can have these basic metadata properties:</p>
<pre><code class="typescript"><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">IMeta</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">title</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// Human-readable name</span><br/><span class="hl-1">  </span><span class="hl-4">description</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// What this component does</span><br/><span class="hl-1">  </span><span class="hl-4">tags</span><span class="hl-1">?: </span><span class="hl-8">TagType</span><span class="hl-1">[]; </span><span class="hl-5">// Categories and behavioral flags</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:simple-documentation-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Simple Documentation Example<a href="#md:simple-documentation-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userService</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.services.user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;User Management Service&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Handles user creation, authentication, and profile management&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;service&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;core&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">database</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">database</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-0">createUser</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">/* ... */</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">    </span><span class="hl-0">authenticateUser</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">credentials</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-5">/* ... */</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sendWelcomeEmail</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.sendWelcomeEmail&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Send Welcome Email&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Sends a welcome email to newly registered users&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;email&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;automation&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;user-onboarding&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">emailService</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">, { </span><span class="hl-4">emailService</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Email sending logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:tags-the-powerful-classification-system" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Tags: The Powerful Classification System<a href="#md:tags-the-powerful-classification-system" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tags are the most powerful part of the metadata system. They can be simple strings or sophisticated configuration objects that control component behavior.</p>
<a id="md:string-tags-for-simple-classification" class="tsd-anchor"></a><h4 class="tsd-anchor-link">String Tags for Simple Classification<a href="#md:string-tags-for-simple-classification" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adminTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.admin.deleteUser&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Delete User Account&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Permanently removes a user account and all associated data&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;admin&quot;</span><span class="hl-1">, </span><span class="hl-5">// Access level</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;destructive&quot;</span><span class="hl-1">, </span><span class="hl-5">// Behavioral flag</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;user&quot;</span><span class="hl-1">, </span><span class="hl-5">// Domain</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;gdpr-compliant&quot;</span><span class="hl-1">, </span><span class="hl-5">// Compliance flag</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userId</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Deletion logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Middleware that adds extra logging for destructive operations</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">auditMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.audit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">isDestructive</span><span class="hl-1"> = </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">definition</span><span class="hl-1">.</span><span class="hl-4">meta</span><span class="hl-1">?.</span><span class="hl-4">tags</span><span class="hl-1">?.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&quot;destructive&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">isDestructive</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`🔥 DESTRUCTIVE OPERATION: </span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">auditLogger</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">operation:</span><span class="hl-1"> </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">definition</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">user:</span><span class="hl-1"> </span><span class="hl-0">getCurrentUser</span><span class="hl-1">(),</span><br/><span class="hl-1">        </span><span class="hl-4">timestamp:</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Date</span><span class="hl-1">(),</span><br/><span class="hl-1">      });</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:advanced-tags-with-configuration" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Advanced Tags with Configuration<a href="#md:advanced-tags-with-configuration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>For more sophisticated control, you can create structured tags that carry configuration:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">tag</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Define a reusable tag with configuration</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">performanceTag</span><span class="hl-1"> = </span><span class="hl-0">tag</span><span class="hl-1">&lt;{ </span><span class="hl-4">alertAboveMs</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1">; </span><span class="hl-4">criticalAboveMs</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;performance.monitoring&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rateLimitTag</span><span class="hl-1"> = </span><span class="hl-0">tag</span><span class="hl-1">&lt;{ </span><span class="hl-4">maxRequestsPerMinute</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1">; </span><span class="hl-4">burstLimit</span><span class="hl-1">?: </span><span class="hl-8">number</span><span class="hl-1"> }&gt;(</span><br/><span class="hl-1">  {</span><br/><span class="hl-1">    </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;rate.limit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cacheTag</span><span class="hl-1"> = </span><span class="hl-0">tag</span><span class="hl-1">&lt;{ </span><span class="hl-4">ttl</span><span class="hl-1">: </span><span class="hl-8">number</span><span class="hl-1">; </span><span class="hl-4">keyPattern</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;cache.strategy&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Use structured tags in your components</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">expensiveTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.expensiveCalculation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Complex Data Processing&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Performs heavy computational analysis on large datasets&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;computation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;background&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">performanceTag</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">alertAboveMs:</span><span class="hl-1"> </span><span class="hl-10">5000</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">criticalAboveMs:</span><span class="hl-1"> </span><span class="hl-10">15000</span><span class="hl-1">,</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">      </span><span class="hl-4">cacheTag</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">ttl:</span><span class="hl-1"> </span><span class="hl-10">300000</span><span class="hl-1">, </span><span class="hl-5">// 5 minutes</span><br/><span class="hl-1">        </span><span class="hl-4">keyPattern:</span><span class="hl-1"> </span><span class="hl-2">&quot;calc-{userId}-{datasetId}&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Heavy computation here</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">apiEndpoint</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.api.getUserProfile&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Get User Profile&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Returns user profile information with privacy filtering&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;api&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;public&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">rateLimitTag</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({</span><br/><span class="hl-1">        </span><span class="hl-4">maxRequestsPerMinute:</span><span class="hl-1"> </span><span class="hl-10">100</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">burstLimit:</span><span class="hl-1"> </span><span class="hl-10">20</span><span class="hl-1">,</span><br/><span class="hl-1">      }),</span><br/><span class="hl-1">      </span><span class="hl-4">cacheTag</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">ttl:</span><span class="hl-1"> </span><span class="hl-10">60000</span><span class="hl-1"> }), </span><span class="hl-5">// 1 minute cache</span><br/><span class="hl-1">    ],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userId</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// API logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:smart-middleware-using-structured-tags" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Smart Middleware Using Structured Tags<a href="#md:smart-middleware-using-structured-tags" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">performanceMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.performance&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">tags</span><span class="hl-1"> = </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">definition</span><span class="hl-1">.</span><span class="hl-4">meta</span><span class="hl-1">?.</span><span class="hl-4">tags</span><span class="hl-1"> || [];</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">perfConfig</span><span class="hl-1"> = </span><span class="hl-4">performanceTag</span><span class="hl-1">.</span><span class="hl-0">extract</span><span class="hl-1">(</span><span class="hl-4">tags</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">perfConfig</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">startTime</span><span class="hl-1"> = </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">();</span><br/><br/><span class="hl-1">      </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">duration</span><span class="hl-1"> = </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-4">startTime</span><span class="hl-1">;</span><br/><br/><span class="hl-1">        </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">duration</span><span class="hl-1"> &gt; </span><span class="hl-4">perfConfig</span><span class="hl-1">.</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">criticalAboveMs</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">alerting</span><span class="hl-1">.</span><span class="hl-0">critical</span><span class="hl-1">(</span><br/><span class="hl-1">            </span><span class="hl-2">`Task </span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2"> took </span><span class="hl-6">${</span><span class="hl-4">duration</span><span class="hl-6">}</span><span class="hl-2">ms`</span><br/><span class="hl-1">          );</span><br/><span class="hl-1">        } </span><span class="hl-3">else</span><span class="hl-1"> </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">duration</span><span class="hl-1"> &gt; </span><span class="hl-4">perfConfig</span><span class="hl-1">.</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">alertAboveMs</span><span class="hl-1">) {</span><br/><span class="hl-1">          </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">alerting</span><span class="hl-1">.</span><span class="hl-0">warn</span><span class="hl-1">(</span><span class="hl-2">`Task </span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2"> took </span><span class="hl-6">${</span><span class="hl-4">duration</span><span class="hl-6">}</span><span class="hl-2">ms`</span><span class="hl-1">);</span><br/><span class="hl-1">        }</span><br/><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">;</span><br/><span class="hl-1">      } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">duration</span><span class="hl-1"> = </span><span class="hl-4">Date</span><span class="hl-1">.</span><span class="hl-0">now</span><span class="hl-1">() - </span><span class="hl-4">startTime</span><span class="hl-1">;</span><br/><span class="hl-1">        </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">alerting</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><br/><span class="hl-1">          </span><span class="hl-2">`Task </span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2"> failed after </span><span class="hl-6">${</span><span class="hl-4">duration</span><span class="hl-6">}</span><span class="hl-2">ms`</span><span class="hl-1">,</span><br/><span class="hl-1">          </span><span class="hl-4">error</span><br/><span class="hl-1">        );</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">;</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rateLimitMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.rateLimit&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">redis</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }, { </span><span class="hl-4">redis</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Extraction can be done at task.definition level or at task.definition.meta.tags</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rateLimitCurrentTag</span><span class="hl-1"> = </span><span class="hl-4">rateLimitTag</span><span class="hl-1">.</span><span class="hl-0">extract</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">definition</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Alternative way</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">tags</span><span class="hl-1"> = </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">definition</span><span class="hl-1">.</span><span class="hl-4">meta</span><span class="hl-1">?.</span><span class="hl-4">tags</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">rateLimitCurrentTag</span><span class="hl-1"> = </span><span class="hl-4">rateLimitTag</span><span class="hl-1">.</span><span class="hl-0">extract</span><span class="hl-1">(</span><span class="hl-4">tags</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">rateLimitCurrentTag</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">key</span><span class="hl-1"> = </span><span class="hl-2">`rateLimit:</span><span class="hl-6">${</span><span class="hl-4">task</span><span class="hl-9">.</span><span class="hl-4">definition</span><span class="hl-9">.</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">current</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">incr</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">);</span><br/><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">current</span><span class="hl-1"> === </span><span class="hl-10">1</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">redis</span><span class="hl-1">.</span><span class="hl-0">expire</span><span class="hl-1">(</span><span class="hl-4">key</span><span class="hl-1">, </span><span class="hl-10">60</span><span class="hl-1">); </span><span class="hl-5">// 1 minute window</span><br/><span class="hl-1">      }</span><br/><br/><span class="hl-1">      </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">current</span><span class="hl-1"> &gt; </span><span class="hl-4">rateLimitCurrentTag</span><span class="hl-1">.</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">maxRequestsPerMinute</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Rate limit exceeded&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:when-to-use-metadata" class="tsd-anchor"></a><h3 class="tsd-anchor-link">When to Use Metadata<a href="#md:when-to-use-metadata" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="md:✅-great-use-cases" class="tsd-anchor"></a><h4 class="tsd-anchor-link">✅ Great Use Cases<a href="#md:✅-great-use-cases" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Documentation &amp; Discovery</strong></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">paymentProcessor</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Payment Processing Service&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><br/><span class="hl-1">      </span><span class="hl-2">&quot;Handles credit card payments via Stripe API with fraud detection&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;payment&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;stripe&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;pci-compliant&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... implementation</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Conditional Behavior</strong></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">backgroundTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;background&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;low-priority&quot;</span><span class="hl-1">, </span><span class="hl-4">retryTag</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">maxAttempts:</span><span class="hl-1"> </span><span class="hl-10">5</span><span class="hl-1"> })],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... implementation</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Cross-Cutting Concerns</strong></p>
<pre><code class="typescript"><span class="hl-5">// All tasks tagged with &quot;audit&quot; get automatic logging</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sensitiveOperation</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;audit&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;sensitive&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;admin-only&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... implementation</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p><strong>Environment-Specific Behavior</strong></p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">developmentTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;development-only&quot;</span><span class="hl-1">, </span><span class="hl-4">debugTag</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">verbose:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> })],</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... implementation</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:❌-when-not-to-use-metadata" class="tsd-anchor"></a><h4 class="tsd-anchor-link">❌ When NOT to Use Metadata<a href="#md:❌-when-not-to-use-metadata" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p><strong>Simple Internal Logic</strong> - Don't overcomplicate straightforward code:</p>
<pre><code class="typescript"><span class="hl-5">// ❌ Overkill</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">simple</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> { </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;internal&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;utility&quot;</span><span class="hl-1">] },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// ✅ Better</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-0">generateId</span><span class="hl-1"> = () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">Math</span><span class="hl-1">.</span><span class="hl-0">random</span><span class="hl-1">().</span><span class="hl-0">toString</span><span class="hl-1">(</span><span class="hl-10">36</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p><strong>One-Off Tasks</strong> - If it's used once, metadata won't help:</p>
<pre><code class="typescript"><span class="hl-5">// ❌ Unnecessary</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">oneTimeScript</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> { </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Migration Script&quot;</span><span class="hl-1">, </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;migration&quot;</span><span class="hl-1">] },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">/* run once and forget */</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:extending-metadata-custom-properties" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Extending Metadata: Custom Properties<a href="#md:extending-metadata-custom-properties" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>For advanced use cases, you can extend the metadata interfaces to add your own properties:</p>
<pre><code class="typescript"><span class="hl-5">// In your types file</span><br/><span class="hl-6">declare</span><span class="hl-1"> </span><span class="hl-6">module</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">ITaskMeta</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">author</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">version</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">deprecated</span><span class="hl-1">?: </span><span class="hl-8">boolean</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">apiVersion</span><span class="hl-1">?: </span><span class="hl-2">&quot;v1&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;v2&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;v3&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">    </span><span class="hl-4">costLevel</span><span class="hl-1">?: </span><span class="hl-2">&quot;low&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;medium&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;high&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">interface</span><span class="hl-1"> </span><span class="hl-8">IResourceMeta</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">healthCheck</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-5">// URL for health checking</span><br/><span class="hl-1">    </span><span class="hl-4">dependencies</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">[]; </span><span class="hl-5">// External service dependencies</span><br/><span class="hl-1">    </span><span class="hl-4">scalingPolicy</span><span class="hl-1">?: </span><span class="hl-2">&quot;auto&quot;</span><span class="hl-1"> | </span><span class="hl-2">&quot;manual&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Now use your custom properties</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">expensiveApiTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.ai.generateImage&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;AI Image Generation&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">description:</span><span class="hl-1"> </span><span class="hl-2">&quot;Uses OpenAI DALL-E to generate images from text prompts&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;ai&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;expensive&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;external-api&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">author:</span><span class="hl-1"> </span><span class="hl-2">&quot;AI Team&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">version:</span><span class="hl-1"> </span><span class="hl-2">&quot;2.1.0&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">apiVersion:</span><span class="hl-1"> </span><span class="hl-2">&quot;v2&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">costLevel:</span><span class="hl-1"> </span><span class="hl-2">&quot;high&quot;</span><span class="hl-1">, </span><span class="hl-5">// Custom property!</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">prompt</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// AI generation logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">database</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.database.primary&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">meta:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">title:</span><span class="hl-1"> </span><span class="hl-2">&quot;Primary PostgreSQL Database&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">tags:</span><span class="hl-1"> [</span><span class="hl-2">&quot;database&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;critical&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;persistent&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">healthCheck:</span><span class="hl-1"> </span><span class="hl-2">&quot;/health/db&quot;</span><span class="hl-1">, </span><span class="hl-5">// Custom property!</span><br/><span class="hl-1">    </span><span class="hl-4">dependencies:</span><span class="hl-1"> [</span><span class="hl-2">&quot;postgresql&quot;</span><span class="hl-1">, </span><span class="hl-2">&quot;connection-pool&quot;</span><span class="hl-1">],</span><br/><span class="hl-1">    </span><span class="hl-4">scalingPolicy:</span><span class="hl-1"> </span><span class="hl-2">&quot;auto&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... implementation</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:advanced-patterns" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Advanced Patterns<a href="#md:advanced-patterns" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="md:tag-based-component-selection" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Tag-Based Component Selection<a href="#md:tag-based-component-selection" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-5">// Find all API endpoints</span><br/><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">getApiTasks</span><span class="hl-1">(</span><span class="hl-4">store</span><span class="hl-1">: </span><span class="hl-8">Store</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">store</span><span class="hl-1">.</span><span class="hl-0">getAllTasks</span><span class="hl-1">().</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">task</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">meta</span><span class="hl-1">?.</span><span class="hl-4">tags</span><span class="hl-1">?.</span><span class="hl-0">includes</span><span class="hl-1">(</span><span class="hl-2">&quot;api&quot;</span><span class="hl-1">));</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Find all tasks with specific performance requirements</span><br/><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">getPerformanceCriticalTasks</span><span class="hl-1">(</span><span class="hl-4">store</span><span class="hl-1">: </span><span class="hl-8">Store</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">store</span><span class="hl-1">.</span><span class="hl-0">getAllTasks</span><span class="hl-1">().</span><span class="hl-0">filter</span><span class="hl-1">((</span><span class="hl-4">task</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">tags</span><span class="hl-1"> = </span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">meta</span><span class="hl-1">?.</span><span class="hl-4">tags</span><span class="hl-1"> || [];</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">performanceTag</span><span class="hl-1">.</span><span class="hl-0">extract</span><span class="hl-1">(</span><span class="hl-4">tags</span><span class="hl-1">) !== </span><span class="hl-6">null</span><span class="hl-1">;</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:dynamic-middleware-application" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Dynamic Middleware Application<a href="#md:dynamic-middleware-application" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">// Apply performance middleware globally but only to tagged tasks</span><br/><span class="hl-1">    </span><span class="hl-4">performanceMiddleware</span><span class="hl-1">.</span><span class="hl-0">everywhere</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">tasks:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">resources:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">    </span><span class="hl-5">// Apply rate limiting only to API tasks</span><br/><span class="hl-1">    </span><span class="hl-4">rateLimitMiddleware</span><span class="hl-1">.</span><span class="hl-0">everywhere</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">tasks:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">resources:</span><span class="hl-1"> </span><span class="hl-6">false</span><span class="hl-1">,</span><br/><span class="hl-1">    }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Metadata transforms your components from anonymous functions into self-documenting, discoverable, and controllable building blocks. Use it wisely, and your future self (and your team) will thank you.</p>
<a id="md:advanced-usage-when-you-need-more-power" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Advanced Usage: When You Need More Power<a href="#md:advanced-usage-when-you-need-more-power" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:overrides-swapping-components-at-runtime" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Overrides: Swapping Components at Runtime<a href="#md:overrides-swapping-components-at-runtime" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sometimes you need to replace a component entirely. Maybe you're doing integration testing or you want to override a library from an external package.</p>
<p>You can now use a dedicated helper <code>override()</code> to safely override any property on tasks, resources, or middleware — except <code>id</code>. This ensures the identity is preserved, while allowing behavior changes.</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">productionEmailer</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.emailer&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">SMTPEmailer</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Option 1: Using override() to change behavior while preserving id (Recommended)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">testEmailer</span><span class="hl-1"> = </span><span class="hl-0">override</span><span class="hl-1">(</span><span class="hl-4">productionEmailer</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MockEmailer</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Option 2: Using spread operator, does not provide type-safety</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">testEmailer</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  ...</span><span class="hl-4">productionEmailer</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {},</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">productionEmailer</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">overrides:</span><span class="hl-1"> [</span><span class="hl-4">testEmailer</span><span class="hl-1">], </span><span class="hl-5">// This replaces the production version</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">override</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Tasks</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">originalTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.compute&quot;</span><span class="hl-1">, </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">1</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">overriddenTask</span><span class="hl-1"> = </span><span class="hl-0">override</span><span class="hl-1">(</span><span class="hl-4">originalTask</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-10">2</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Resources</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">originalResource</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.db&quot;</span><span class="hl-1">, </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;conn&quot;</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">overriddenResource</span><span class="hl-1"> = </span><span class="hl-0">override</span><span class="hl-1">(</span><span class="hl-4">originalResource</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-2">&quot;mock-conn&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Middleware</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">originalMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.log&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">overriddenMiddleware</span><span class="hl-1"> = </span><span class="hl-0">override</span><span class="hl-1">(</span><span class="hl-4">originalMiddleware</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">?.</span><span class="hl-4">input</span><span class="hl-1"> </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-8">any</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">wrapped:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1"> } </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-8">any</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>Overrides are applied after everything is registered. If multiple overrides target the same id, the one defined higher in the resource tree (closer to the root) wins, because it’s applied last. Conflicting overrides are allowed; overriding something that wasn’t registered throws. Use override() to change behavior safely while preserving the original id.</p>
<a id="md:namespacing-keeping-things-organized" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Namespacing: Keeping Things Organized<a href="#md:namespacing-keeping-things-organized" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>As your app grows, you'll want consistent naming. Here's the convention that won't drive you crazy:</p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Format</th>
</tr>
</thead>
<tbody>
<tr>
<td>Tasks</td>
<td><code>{domain}.tasks.{taskName}</code></td>
</tr>
<tr>
<td>Listener Tasks</td>
<td><code>{domain}.tasks.{taskName}.on{EventName}</code></td>
</tr>
<tr>
<td>Resources</td>
<td><code>{domain}.resources.{resourceName}</code></td>
</tr>
<tr>
<td>Events</td>
<td><code>{domain}.events.{eventName}</code></td>
</tr>
<tr>
<td>Middleware</td>
<td><code>{domain}.middleware.{middlewareName}</code></td>
</tr>
</tbody>
</table>
<pre><code class="typescript"><span class="hl-5">// Helper function for consistency</span><br/><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">namespaced</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`mycompany.myapp.</span><span class="hl-6">${</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-0">namespaced</span><span class="hl-1">(</span><span class="hl-2">&quot;tasks.user.create&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-5">// ...</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:factory-pattern-for-when-you-need-instances" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Factory Pattern: For When You Need Instances<a href="#md:factory-pattern-for-when-you-need-instances" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>To keep things dead simple, we avoided poluting the D.I. with this concept. Therefore, we recommend using a resource with a factory function to create instances of your classes:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">myFactory</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.factories.myFactory&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">: { </span><span class="hl-4">someOption</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> (</span><span class="hl-4">input</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MyClass</span><span class="hl-1">(</span><span class="hl-4">input</span><span class="hl-1">, </span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">someOption</span><span class="hl-1">);</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">myFactory</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">myFactory</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">myFactory</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">instance</span><span class="hl-1"> = </span><span class="hl-0">myFactory</span><span class="hl-1">({ </span><span class="hl-4">someOption:</span><span class="hl-1"> </span><span class="hl-2">&quot;value&quot;</span><span class="hl-1"> });</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:internal-services-for-when-you-need-direct-access" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Internal Services: For When You Need Direct Access<a href="#md:internal-services-for-when-you-need-direct-access" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>We expose the internal services for advanced use cases (but try not to use them unless you really need to):</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">globals</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">advancedTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.advanced&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">store:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">store</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">taskRunner:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">taskRunner</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">eventManager:</span><span class="hl-1"> </span><span class="hl-4">globals</span><span class="hl-1">.</span><span class="hl-4">resources</span><span class="hl-1">.</span><span class="hl-4">eventManager</span><span class="hl-1">,</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">store</span><span class="hl-1">, </span><span class="hl-4">taskRunner</span><span class="hl-1">, </span><span class="hl-4">eventManager</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Direct access to the framework internals</span><br/><span class="hl-1">    </span><span class="hl-5">// (Use with caution!)</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:dependency-patterns-static-vs-dynamic" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Dependency Patterns: Static vs Dynamic<a href="#md:dependency-patterns-static-vs-dynamic" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Dependencies can be defined in two ways - as a static object or as a function that returns an object. Each approach has its use cases:</p>
<pre><code class="typescript"><span class="hl-5">// Static dependencies (most common)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userService</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.services.user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">database</span><span class="hl-1">, </span><span class="hl-4">logger</span><span class="hl-1"> }, </span><span class="hl-5">// Object - evaluated immediately</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">database</span><span class="hl-1">, </span><span class="hl-4">logger</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Dependencies are available here</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Dynamic dependencies (for circular references or conditional dependencies)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">advancedService</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.services.advanced&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-5">// A function gives you the chance</span><br/><span class="hl-1">  </span><span class="hl-0">dependencies</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-5">// Config is what you receive when you register tise resource with .with()</span><br/><span class="hl-1">    </span><span class="hl-5">// So you can have conditional dependencies based on resource configuration as well.</span><br/><span class="hl-1">    </span><span class="hl-4">database</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">logger</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">conditionalService:</span><br/><span class="hl-1">      </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">NODE_ENV</span><span class="hl-1"> === </span><span class="hl-2">&quot;production&quot;</span><span class="hl-1"> ? </span><span class="hl-4">serviceA</span><span class="hl-1"> : </span><span class="hl-4">serviceB</span><span class="hl-1">,</span><br/><span class="hl-1">  }), </span><span class="hl-5">// Function - evaluated when needed</span><br/><span class="hl-1">  </span><span class="hl-0">register</span><span class="hl-4">:</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">// Config is what you receive when you register the resource with .with()</span><br/><span class="hl-1">    </span><span class="hl-5">// Register dependencies dynamically</span><br/><span class="hl-1">    </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">NODE_ENV</span><span class="hl-1"> === </span><span class="hl-2">&quot;production&quot;</span><br/><span class="hl-1">      ? </span><span class="hl-4">serviceA</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">config:</span><span class="hl-1"> </span><span class="hl-2">&quot;value&quot;</span><span class="hl-1"> })</span><br/><span class="hl-1">      : </span><span class="hl-4">serviceB</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">config:</span><span class="hl-1"> </span><span class="hl-2">&quot;value&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">database</span><span class="hl-1">, </span><span class="hl-4">logger</span><span class="hl-1">, </span><span class="hl-4">conditionalService</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Same interface, different evaluation timing</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>The function pattern essentially gives you &quot;just-in-time&quot; dependency resolution instead of &quot;eager&quot; dependency resolution, which provides more flexibility and better handles complex dependency scenarios that arise in real-world applications.</p>
<p><strong>Performance note</strong>: Function-based dependencies have minimal overhead - they're only called once during dependency resolution.</p>
<a id="md:handling-circular-type-dependencies-breaking-the-chain" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Handling Circular &quot;Type&quot; Dependencies: Breaking the Chain<a href="#md:handling-circular-type-dependencies-breaking-the-chain" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Sometimes you'll run into circular type dependencies because of your file structure not necessarily because of a real circular dependency. TypeScript struggles with these, but there's a way to handle it gracefully.</p>
<a id="md:the-problem-self-referencing-types" class="tsd-anchor"></a><h4 class="tsd-anchor-link">The Problem: Self-Referencing Types<a href="#md:the-problem-self-referencing-types" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Consider these resources that create a circular dependency:</p>
<pre><code class="typescript"><span class="hl-5">// FILE: a.ts</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">aResource</span><span class="hl-1"> = </span><span class="hl-0">defineResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">b:</span><span class="hl-1"> </span><span class="hl-4">bResource</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-5">// ... depends on B resource.</span><br/><span class="hl-1">});</span><br/><span class="hl-5">// For whatever reason, you decide to put the task in the same file.</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">aTask</span><span class="hl-1"> = </span><span class="hl-0">defineTask</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">a:</span><span class="hl-1"> </span><span class="hl-4">aResource</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// FILE: b.ts</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">bResource</span><span class="hl-1"> = </span><span class="hl-0">defineResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;b.resource&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">c:</span><span class="hl-1"> </span><span class="hl-4">cResource</span><span class="hl-1"> },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// FILE: c.ts</span><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cResource</span><span class="hl-1"> = </span><span class="hl-0">defineResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;c.resource&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">aTask</span><span class="hl-1"> }, </span><span class="hl-5">// Creates circular **type** dependency! Cannot infer types properly, even if the runner boots because there&#39;s no circular dependency.</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">aTask</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`C depends on aTask`</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<p>A depends B depends C depends ATask. No circular dependency, yet Typescript struggles with these, but there's a way to handle it gracefully.</p>
<a id="md:the-solution-type-annotations" class="tsd-anchor"></a><h4 class="tsd-anchor-link">The Solution: Type Annotations<a href="#md:the-solution-type-annotations" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>The fix is to explicitly type the resource that completes the circle using a simple assertion <code>IResource&lt;Config, ReturnType&gt;</code>. This breaks the TypeScript inference chain while maintaining runtime functionality:</p>
<pre><code class="typescript"><span class="hl-5">// c.resource.ts - The key change</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">IResource</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;../../defs&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">cResource</span><span class="hl-1"> = </span><span class="hl-0">defineResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;c.resource&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">a:</span><span class="hl-1"> </span><span class="hl-4">aResource</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">a</span><span class="hl-1"> }) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">`C depends on </span><span class="hl-6">${</span><span class="hl-4">a</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}) </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-8">IResource</span><span class="hl-1">&lt;</span><span class="hl-8">void</span><span class="hl-1">, </span><span class="hl-8">string</span><span class="hl-1">&gt;; </span><span class="hl-5">// void because it has no config, string because it returns a string</span>
</code><button type="button">Copy</button></pre>

<a id="md:why-this-works" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Why This Works<a href="#md:why-this-works" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ul>
<li><strong>Runtime</strong>: The circular dependency still works at runtime because the framework resolves dependencies dynamically</li>
<li><strong>TypeScript</strong>: The explicit type annotation prevents TypeScript from trying to infer the return type based on the circular chain</li>
<li><strong>Type Safety</strong>: You still get full type safety by explicitly declaring the return type (<code>string</code> in this example)</li>
</ul>
<a id="md:best-practices" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Best Practices<a href="#md:best-practices" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><ol>
<li><strong>Identify the &quot;leaf&quot; resource</strong>: Choose the resource that logically should break the chain (often the one that doesn't need complex type inference)</li>
<li><strong>Use explicit typing</strong>: Add the <code>IResource&lt;Dependencies, ReturnType&gt;</code> type annotation</li>
<li><strong>Document the decision</strong>: Add a comment explaining why the explicit typing is needed</li>
<li><strong>Consider refactoring</strong>: If you have many circular dependencies, consider if your architecture could be simplified</li>
</ol>
<a id="md:example-with-dependencies" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Example with Dependencies<a href="#md:example-with-dependencies" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>If your resource has dependencies, include them in the type:</p>
<pre><code class="typescript"><span class="hl-6">type</span><span class="hl-1"> </span><span class="hl-8">MyDependencies</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">someService</span><span class="hl-1">: </span><span class="hl-8">SomeServiceType</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">anotherResource</span><span class="hl-1">: </span><span class="hl-8">AnotherResourceType</span><span class="hl-1">;</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">problematicResource</span><span class="hl-1"> = </span><span class="hl-0">defineResource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;problematic.resource&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">/* ... */</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">init</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">deps</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Your logic here</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">someComplexObject</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">}) </span><span class="hl-3">as</span><span class="hl-1"> </span><span class="hl-8">IResource</span><span class="hl-1">&lt;</span><span class="hl-8">MyDependencies</span><span class="hl-1">, </span><span class="hl-8">ComplexReturnType</span><span class="hl-1">&gt;;</span>
</code><button type="button">Copy</button></pre>

<p>This pattern allows you to maintain clean, type-safe code while handling the inevitable circular dependencies that arise in complex applications.</p>
<a id="md:real-world-example-the-complete-package" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Real-World Example: The Complete Package<a href="#md:real-world-example-the-complete-package" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Here's a more realistic application structure that shows everything working together:</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">resource</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">task</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">event</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">index</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">run</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">createContext</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Configuration</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">config</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.config&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-4">port:</span><span class="hl-1"> </span><span class="hl-0">parseInt</span><span class="hl-1">(</span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">PORT</span><span class="hl-1"> || </span><span class="hl-2">&quot;3000&quot;</span><span class="hl-1">),</span><br/><span class="hl-1">    </span><span class="hl-4">databaseUrl:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">DATABASE_URL</span><span class="hl-1">!,</span><br/><span class="hl-1">    </span><span class="hl-4">jwtSecret:</span><span class="hl-1"> </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-4">env</span><span class="hl-1">.</span><span class="hl-7">JWT_SECRET</span><span class="hl-1">!,</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Database</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">database</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.database&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">config</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">config</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">client</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">MongoClient</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">databaseUrl</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">connect</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">dispose</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">client</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">client</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Context for request data</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">RequestContext</span><span class="hl-1"> = </span><span class="hl-0">createContext</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">role</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;(</span><br/><span class="hl-1">  </span><span class="hl-2">&quot;app.requestContext&quot;</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// Events</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userRegistered</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">userId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">email</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.events.userRegistered&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Middleware</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">authMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">&lt;{ </span><span class="hl-4">requiredRole</span><span class="hl-1">?: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.auth&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }, </span><span class="hl-4">deps</span><span class="hl-1">, </span><span class="hl-4">config</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">context</span><span class="hl-1"> = </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">config</span><span class="hl-1">?.</span><span class="hl-4">requiredRole</span><span class="hl-1"> &amp;&amp; </span><span class="hl-4">context</span><span class="hl-1">.</span><span class="hl-4">role</span><span class="hl-1"> !== </span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">requiredRole</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Insufficient permissions&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">.</span><span class="hl-4">input</span><span class="hl-1">);</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Services</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">userService</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.services.user&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">database</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">database</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> ({</span><br/><span class="hl-1">    </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">: { </span><span class="hl-4">name</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">; </span><span class="hl-4">email</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }) {</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">users</span><span class="hl-1"> = </span><span class="hl-4">database</span><span class="hl-1">.</span><span class="hl-0">collection</span><span class="hl-1">(</span><span class="hl-2">&quot;users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">users</span><span class="hl-1">.</span><span class="hl-0">insertOne</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> { </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">insertedId</span><span class="hl-1">.</span><span class="hl-0">toString</span><span class="hl-1">(), ...</span><span class="hl-4">userData</span><span class="hl-1"> };</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  }),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Business Logic</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">registerUser</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.registerUser&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">userService</span><span class="hl-1">, </span><span class="hl-4">userRegistered</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">, { </span><span class="hl-4">userService</span><span class="hl-1">, </span><span class="hl-4">userRegistered</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">userService</span><span class="hl-1">.</span><span class="hl-0">createUser</span><span class="hl-1">(</span><span class="hl-4">userData</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">userRegistered</span><span class="hl-1">({ </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">email</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">adminOnlyTask</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.adminOnly&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">middleware:</span><span class="hl-1"> [</span><span class="hl-4">authMiddleware</span><span class="hl-1">.</span><span class="hl-0">with</span><span class="hl-1">({ </span><span class="hl-4">requiredRole:</span><span class="hl-1"> </span><span class="hl-2">&quot;admin&quot;</span><span class="hl-1"> })],</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Top secret admin data&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Event Handlers</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">sendWelcomeEmail</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.sendWelcomeEmail&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">on:</span><span class="hl-1"> </span><span class="hl-4">userRegistered</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">event</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Sending welcome email to </span><span class="hl-6">${</span><span class="hl-4">event</span><span class="hl-9">.</span><span class="hl-4">data</span><span class="hl-9">.</span><span class="hl-4">email</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-5">// Email sending logic here</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Group everything together</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">services</span><span class="hl-1"> = </span><span class="hl-0">index</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">userService</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">registerUser</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">adminOnlyTask</span><span class="hl-1">,</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Express server</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.server&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">database</span><span class="hl-1">, </span><span class="hl-4">services</span><span class="hl-1">, </span><span class="hl-4">sendWelcomeEmail</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">services</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">_</span><span class="hl-1">, { </span><span class="hl-4">config</span><span class="hl-1">, </span><span class="hl-4">services</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">express</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">(</span><span class="hl-4">express</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">());</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Middleware to set up request context</span><br/><span class="hl-1">    </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">use</span><span class="hl-1">((</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">RequestContext</span><span class="hl-1">.</span><span class="hl-0">provide</span><span class="hl-1">(</span><br/><span class="hl-1">        { </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">[</span><span class="hl-2">&quot;user-id&quot;</span><span class="hl-1">], </span><span class="hl-4">role:</span><span class="hl-1"> </span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">headers</span><span class="hl-1">[</span><span class="hl-2">&quot;user-role&quot;</span><span class="hl-1">] },</span><br/><span class="hl-1">        () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-0">next</span><span class="hl-1">()</span><br/><span class="hl-1">      );</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">post</span><span class="hl-1">(</span><span class="hl-2">&quot;/register&quot;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-0">registerUser</span><span class="hl-1">(</span><span class="hl-4">req</span><span class="hl-1">.</span><span class="hl-4">body</span><span class="hl-1">);</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1">, </span><span class="hl-4">user</span><span class="hl-1"> });</span><br/><span class="hl-1">      } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-10">400</span><span class="hl-1">).</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">get</span><span class="hl-1">(</span><span class="hl-2">&quot;/admin&quot;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">req</span><span class="hl-1">, </span><span class="hl-4">res</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">data</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">services</span><span class="hl-1">.</span><span class="hl-0">adminOnlyTask</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">data</span><span class="hl-1"> });</span><br/><span class="hl-1">      } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-4">res</span><span class="hl-1">.</span><span class="hl-0">status</span><span class="hl-1">(</span><span class="hl-10">403</span><span class="hl-1">).</span><span class="hl-0">json</span><span class="hl-1">({ </span><span class="hl-4">error:</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">message</span><span class="hl-1"> });</span><br/><span class="hl-1">      }</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-4">app</span><span class="hl-1">.</span><span class="hl-0">listen</span><span class="hl-1">(</span><span class="hl-4">config</span><span class="hl-1">.</span><span class="hl-4">port</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Server running on port </span><span class="hl-6">${</span><span class="hl-4">config</span><span class="hl-9">.</span><span class="hl-4">port</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">server</span><span class="hl-1">;</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">  </span><span class="hl-0">dispose</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">server</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">server</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Start the application</span><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-7">dispose</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">server</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Graceful shutdown</span><br/><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&quot;SIGTERM&quot;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Shutting down gracefully...&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">process</span><span class="hl-1">.</span><span class="hl-0">exit</span><span class="hl-1">(</span><span class="hl-10">0</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:testing-actually-enjoyable" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Testing: Actually Enjoyable<a href="#md:testing-actually-enjoyable" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:unit-testing-mock-everything-test-everything" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Unit Testing: Mock Everything, Test Everything<a href="#md:unit-testing-mock-everything-test-everything" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Unit testing is straightforward because everything is explicit:</p>
<pre><code class="typescript"><span class="hl-0">describe</span><span class="hl-1">(</span><span class="hl-2">&quot;registerUser task&quot;</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-0">it</span><span class="hl-1">(</span><span class="hl-2">&quot;should create a user and emit event&quot;</span><span class="hl-1">, </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">mockUserService</span><span class="hl-1"> = {</span><br/><span class="hl-1">      </span><span class="hl-4">createUser:</span><span class="hl-1"> </span><span class="hl-4">jest</span><span class="hl-1">.</span><span class="hl-0">fn</span><span class="hl-1">().</span><span class="hl-0">mockResolvedValue</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;123&quot;</span><span class="hl-1">, </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;John&quot;</span><span class="hl-1"> }),</span><br/><span class="hl-1">    };</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">mockEvent</span><span class="hl-1"> = </span><span class="hl-4">jest</span><span class="hl-1">.</span><span class="hl-0">fn</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">registerUser</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><br/><span class="hl-1">      { </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&quot;John&quot;</span><span class="hl-1">, </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-2">&quot;john@example.com&quot;</span><span class="hl-1"> },</span><br/><span class="hl-1">      { </span><span class="hl-4">userService:</span><span class="hl-1"> </span><span class="hl-4">mockUserService</span><span class="hl-1">, </span><span class="hl-4">userRegistered:</span><span class="hl-1"> </span><span class="hl-4">mockEvent</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><br/><span class="hl-1">    </span><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">).</span><span class="hl-0">toBe</span><span class="hl-1">(</span><span class="hl-2">&quot;123&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">mockEvent</span><span class="hl-1">).</span><span class="hl-0">toHaveBeenCalledWith</span><span class="hl-1">({</span><br/><span class="hl-1">      </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-2">&quot;123&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">      </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-2">&quot;john@example.com&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    });</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:integration-testing-the-real-deal-but-actually-fun" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Integration Testing: The Real Deal (But Actually Fun)<a href="#md:integration-testing-the-real-deal-but-actually-fun" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Spin up your whole app, keep all the middleware/events, and still test like a human. The trick: a tiny test harness.</p>
<pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">run</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">createTestResource</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">resource</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">task</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">override</span><span class="hl-1">,</span><br/><span class="hl-1">} </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Your real app</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-5">/* tasks, resources, middleware */</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Optional: overrides for infra (hello, fast tests!)</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">testDb</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.database&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">InMemoryDb</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">mockMailer</span><span class="hl-1"> = </span><span class="hl-0">override</span><span class="hl-1">(</span><span class="hl-4">realMailer</span><span class="hl-1">, { </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">fakeMailer</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Create the test harness</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">harness</span><span class="hl-1"> = </span><span class="hl-0">createTestResource</span><span class="hl-1">(</span><span class="hl-4">app</span><span class="hl-1">, { </span><span class="hl-4">overrides:</span><span class="hl-1"> [</span><span class="hl-4">testDb</span><span class="hl-1">, </span><span class="hl-4">mockMailer</span><span class="hl-1">] });</span><br/><br/><span class="hl-5">// A task you want to drive in your tests</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">registerUser</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({ </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.tasks.registerUser&quot;</span><span class="hl-1"> </span><span class="hl-5">/* ... */</span><span class="hl-1"> });</span><br/><br/><span class="hl-5">// Boom: full ecosystem run (middleware, events, overrides) with a tiny driver</span><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-7">t</span><span class="hl-1">, </span><span class="hl-7">dispose</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">harness</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">t</span><span class="hl-1">.</span><span class="hl-0">runTask</span><span class="hl-1">(</span><span class="hl-4">registerUser</span><span class="hl-1">, { </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-2">&quot;x@y.z&quot;</span><span class="hl-1"> });</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">).</span><span class="hl-0">toMatchObject</span><span class="hl-1">({ </span><span class="hl-4">success:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">dispose</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Prefer scenario tests? Return whatever you want from the harness and assert outside:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">flowHarness</span><span class="hl-1"> = </span><span class="hl-0">createTestResource</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">register:</span><span class="hl-1"> [</span><span class="hl-4">db</span><span class="hl-1">, </span><span class="hl-4">createUser</span><span class="hl-1">, </span><span class="hl-4">issueToken</span><span class="hl-1">],</span><br/><span class="hl-1">  })</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> { </span><span class="hl-4">value</span><span class="hl-1">: </span><span class="hl-7">t</span><span class="hl-1">, </span><span class="hl-7">dispose</span><span class="hl-1"> } = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">flowHarness</span><span class="hl-1">);</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">user</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">t</span><span class="hl-1">.</span><span class="hl-0">runTask</span><span class="hl-1">(</span><span class="hl-4">createUser</span><span class="hl-1">, { </span><span class="hl-4">email:</span><span class="hl-1"> </span><span class="hl-2">&quot;a@b.c&quot;</span><span class="hl-1"> });</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">token</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">t</span><span class="hl-1">.</span><span class="hl-0">runTask</span><span class="hl-1">(</span><span class="hl-4">issueToken</span><span class="hl-1">, { </span><span class="hl-4">userId:</span><span class="hl-1"> </span><span class="hl-4">user</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1"> });</span><br/><span class="hl-0">expect</span><span class="hl-1">(</span><span class="hl-4">token</span><span class="hl-1">).</span><span class="hl-0">toBeTruthy</span><span class="hl-1">();</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">dispose</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<p>Why this rocks:</p>
<ul>
<li>Minimal ceremony, no API pollution</li>
<li>Real wiring (middleware/events/overrides) – what runs in prod runs in tests</li>
<li>You choose: drive tasks directly or build domain-y flows</li>
</ul>
<a id="md:semaphore" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Semaphore<a href="#md:semaphore" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Ever had too many database connections competing for resources? Your connection pool under pressure? The <code>Semaphore</code> is here to manage concurrent operations like a professional traffic controller.</p>
<p>Think of it as a VIP rope at an exclusive venue. Only a limited number of operations can proceed at once. The rest wait in an orderly queue like well-behaved async functions.</p>
<a id="md:quick-start" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Quick Start<a href="#md:quick-start" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Semaphore</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">// Create a semaphore that allows max 5 concurrent operations</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">dbSemaphore</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Semaphore</span><span class="hl-1">(</span><span class="hl-10">5</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Basic usage - acquire and release manually</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">();</span><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Do your database magic here</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-2">&quot;SELECT * FROM users&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">(); </span><span class="hl-5">// Critical: always release to prevent bottlenecks</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:the-elegant-approach-withpermit" class="tsd-anchor"></a><h3 class="tsd-anchor-link">The Elegant Approach: withPermit()<a href="#md:the-elegant-approach-withpermit" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Why manage permits manually when you can let the semaphore do the heavy lifting?</p>
<pre><code class="typescript"><span class="hl-5">// The elegant approach - automatic cleanup guaranteed!</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">users</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">withPermit</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-2">&quot;SELECT * FROM users WHERE active = true&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:timeout-support" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Timeout Support<a href="#md:timeout-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Prevent operations from hanging indefinitely with configurable timeouts:</p>
<pre><code class="typescript"><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Wait max 5 seconds, then throw timeout error</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">acquire</span><span class="hl-1">({ </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-10">5000</span><span class="hl-1"> });</span><br/><span class="hl-1">  </span><span class="hl-5">// Your code here</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Operation timed out waiting for permit&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-5">// Or with withPermit</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">withPermit</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">slowDatabaseOperation</span><span class="hl-1">(),</span><br/><span class="hl-1">  { </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-10">10000</span><span class="hl-1"> } </span><span class="hl-5">// 10 second timeout</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:cancellation-support" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Cancellation Support<a href="#md:cancellation-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Operations can be cancelled using AbortSignal:</p>
<pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">controller</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">AbortController</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Start an operation</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">operationPromise</span><span class="hl-1"> = </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">withPermit</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">veryLongOperation</span><span class="hl-1">(),</span><br/><span class="hl-1">  { </span><span class="hl-4">signal:</span><span class="hl-1"> </span><span class="hl-4">controller</span><span class="hl-1">.</span><span class="hl-4">signal</span><span class="hl-1"> }</span><br/><span class="hl-1">);</span><br/><br/><span class="hl-5">// Cancel the operation after 3 seconds</span><br/><span class="hl-0">setTimeout</span><span class="hl-1">(() </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-4">controller</span><span class="hl-1">.</span><span class="hl-0">abort</span><span class="hl-1">();</span><br/><span class="hl-1">}, </span><span class="hl-10">3000</span><span class="hl-1">);</span><br/><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">operationPromise</span><span class="hl-1">;</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Operation was cancelled&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:monitoring-metrics--debugging" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Monitoring: Metrics &amp; Debugging<a href="#md:monitoring-metrics--debugging" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Want to know what's happening under the hood?</p>
<pre><code class="typescript"><span class="hl-5">// Get comprehensive metrics</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">metrics</span><span class="hl-1"> = </span><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">getMetrics</span><span class="hl-1">();</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`</span><br/><span class="hl-2">Semaphore Status Report:</span><br/><span class="hl-2">  Available permits: </span><span class="hl-6">${</span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">availablePermits</span><span class="hl-6">}</span><span class="hl-2">/</span><span class="hl-6">${</span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">maxPermits</span><span class="hl-6">}</span><br/><span class="hl-2">  Operations waiting: </span><span class="hl-6">${</span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">waitingCount</span><span class="hl-6">}</span><br/><span class="hl-2">  Utilization: </span><span class="hl-6">${</span><span class="hl-9">(</span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">utilization</span><span class="hl-9"> </span><span class="hl-1">*</span><span class="hl-9"> </span><span class="hl-10">100</span><span class="hl-9">).</span><span class="hl-0">toFixed</span><span class="hl-9">(</span><span class="hl-10">1</span><span class="hl-9">)</span><span class="hl-6">}</span><span class="hl-2">%</span><br/><span class="hl-2">  Disposed: </span><span class="hl-6">${</span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">disposed</span><span class="hl-9"> </span><span class="hl-1">?</span><span class="hl-9"> </span><span class="hl-2">&quot;Yes&quot;</span><span class="hl-9"> </span><span class="hl-1">:</span><span class="hl-9"> </span><span class="hl-2">&quot;No&quot;</span><span class="hl-6">}</span><br/><span class="hl-2">`</span><span class="hl-1">);</span><br/><br/><span class="hl-5">// Quick checks</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Available permits: </span><span class="hl-6">${</span><span class="hl-4">dbSemaphore</span><span class="hl-9">.</span><span class="hl-0">getAvailablePermits</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Queue length: </span><span class="hl-6">${</span><span class="hl-4">dbSemaphore</span><span class="hl-9">.</span><span class="hl-0">getWaitingCount</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Is disposed: </span><span class="hl-6">${</span><span class="hl-4">dbSemaphore</span><span class="hl-9">.</span><span class="hl-0">isDisposed</span><span class="hl-9">()</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<a id="md:resource-cleanup" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Resource Cleanup<a href="#md:resource-cleanup" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Properly dispose of semaphores when finished:</p>
<pre><code class="typescript"><span class="hl-5">// Reject all waiting operations and prevent new ones</span><br/><span class="hl-4">dbSemaphore</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// All waiting operations will be rejected with:</span><br/><span class="hl-5">// Error: &quot;Semaphore has been disposed&quot;</span>
</code><button type="button">Copy</button></pre>

<a id="md:queue" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Queue<a href="#md:queue" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p><em>The orderly guardian of chaos, the diplomatic bouncer of async operations.</em></p>
<p>The <code>Queue</code> class is your friendly neighborhood task coordinator. Think of it as a very polite but firm British queue-master who ensures everyone waits their turn, prevents cutting in line, and gracefully handles when it's time to close shop.</p>
<a id="md:fifo-ordering" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>FIFO Ordering</strong><a href="#md:fifo-ordering" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Tasks execute one after another in first-in, first-out order. No cutting, no exceptions, no drama.</p>
<a id="md:deadlock-detective" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Deadlock Detective</strong><a href="#md:deadlock-detective" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Using the clever <code>AsyncLocalStorage</code>, our Queue can detect when a task tries to queue another task (the async equivalent of &quot;yo dawg, I heard you like queues...&quot;). When caught red-handed, it politely but firmly rejects with a deadlock error.</p>
<a id="md:graceful-disposal--cancellation" class="tsd-anchor"></a><h3 class="tsd-anchor-link"><strong>Graceful Disposal &amp; Cancellation</strong><a href="#md:graceful-disposal--cancellation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The Queue provides cooperative cancellation through the Web Standard <code>AbortController</code>:</p>
<ul>
<li><strong>Patient mode</strong> (default): Waits for all queued tasks to complete naturally</li>
<li><strong>Cancel mode</strong>: Signals running tasks to abort via <code>AbortSignal</code>, enabling early termination</li>
</ul>
<a id="md:basic-example" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Basic Example<a href="#md:basic-example" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Queue</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&quot;@bluelibs/runner&quot;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Queue</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Queue up some work</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-5">// Your async task here</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Task completed&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Graceful shutdown</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span>
</code><button type="button">Copy</button></pre>

<a id="md:abortcontroller-integration" class="tsd-anchor"></a><h3 class="tsd-anchor-link">AbortController Integration<a href="#md:abortcontroller-integration" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The Queue provides each task with an <code>AbortSignal</code> for cooperative cancellation. Tasks should periodically check this signal to enable early termination.</p>
<a id="md:example-long-running-task-with-cancellation-support" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Example: Long-running Task with Cancellation Support<a href="#md:example-long-running-task-with-cancellation-support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Queue</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Task that respects cancellation</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">processLargeDataset</span><span class="hl-1"> = </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">items</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetchLargeDataset</span><span class="hl-1">();</span><br/><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">item</span><span class="hl-1"> </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">items</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Check for cancellation before processing each item</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">aborted</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Operation was cancelled&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">processItem</span><span class="hl-1">(</span><span class="hl-4">item</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-2">&quot;Dataset processed successfully&quot;</span><span class="hl-1">;</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// Cancel all running tasks</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">({ </span><span class="hl-4">cancel:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<a id="md:example-network-request-with-timeout" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Example: Network Request with Timeout<a href="#md:example-network-request-with-timeout" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Queue</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">fetchWithCancellation</span><span class="hl-1"> = </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Pass the signal to fetch for automatic cancellation</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&quot;https://api.example.com/data&quot;</span><span class="hl-1">, { </span><span class="hl-4">signal</span><span class="hl-1"> });</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span><br/><span class="hl-1">  } </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1"> === </span><span class="hl-2">&quot;AbortError&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Request was cancelled&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// This will cancel the fetch request if still pending</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">({ </span><span class="hl-4">cancel:</span><span class="hl-1"> </span><span class="hl-6">true</span><span class="hl-1"> });</span>
</code><button type="button">Copy</button></pre>

<a id="md:example-file-processing-with-progress-tracking" class="tsd-anchor"></a><h4 class="tsd-anchor-link">Example: File Processing with Progress Tracking<a href="#md:example-file-processing-with-progress-tracking" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Queue</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">processFiles</span><span class="hl-1"> = </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">files</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">getFileList</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">results</span><span class="hl-1"> = [];</span><br/><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">let</span><span class="hl-1"> </span><span class="hl-4">i</span><span class="hl-1"> = </span><span class="hl-10">0</span><span class="hl-1">; </span><span class="hl-4">i</span><span class="hl-1"> &lt; </span><span class="hl-4">files</span><span class="hl-1">.</span><span class="hl-4">length</span><span class="hl-1">; </span><span class="hl-4">i</span><span class="hl-1">++) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Respect cancellation</span><br/><span class="hl-1">    </span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-0">throwIfAborted</span><span class="hl-1">();</span><br/><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">processFile</span><span class="hl-1">(</span><span class="hl-4">files</span><span class="hl-1">[</span><span class="hl-4">i</span><span class="hl-1">]);</span><br/><span class="hl-1">    </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Optional: Report progress</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processed </span><span class="hl-6">${</span><span class="hl-4">i</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-10">1</span><span class="hl-6">}</span><span class="hl-2">/</span><span class="hl-6">${</span><span class="hl-4">files</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2"> files`</span><span class="hl-1">);</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">results</span><span class="hl-1">;</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:the-magic-behind-the-curtain" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Magic Behind the Curtain<a href="#md:the-magic-behind-the-curtain" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:internal-state" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Internal State<a href="#md:internal-state" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><code>tail</code>: The promise chain that maintains FIFO execution order</li>
<li><code>disposed</code>: Boolean flag indicating whether the queue accepts new tasks</li>
<li><code>abortController</code>: Centralized cancellation controller that provides <code>AbortSignal</code> to all tasks</li>
<li><code>executionContext</code>: AsyncLocalStorage-based deadlock detection mechanism</li>
</ul>
<a id="md:error-handling" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Error Handling<a href="#md:error-handling" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>&quot;Queue has been disposed&quot;</strong>: You tried to add work after closing time</li>
<li><strong>&quot;Dead-lock detected&quot;</strong>: A task tried to queue another task (infinite recursion prevention)</li>
</ul>
<a id="md:best-practices-1" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Best Practices<a href="#md:best-practices-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><a id="md:1-always-dispose-resources" class="tsd-anchor"></a><h4 class="tsd-anchor-link">1. Always Dispose Resources<a href="#md:1-always-dispose-resources" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><pre><code class="typescript"><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">queue</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Queue</span><span class="hl-1">();</span><br/><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:2-implement-cooperative-cancellation" class="tsd-anchor"></a><h4 class="tsd-anchor-link">2. Implement Cooperative Cancellation<a href="#md:2-implement-cooperative-cancellation" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Tasks should regularly check the <code>AbortSignal</code> and respond appropriately:</p>
<pre><code class="typescript"><span class="hl-5">// Preferred: Use signal.throwIfAborted() for immediate termination</span><br/><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-0">throwIfAborted</span><span class="hl-1">();</span><br/><br/><span class="hl-5">// Alternative: Check signal.aborted for custom handling</span><br/><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">signal</span><span class="hl-1">.</span><span class="hl-4">aborted</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-0">cleanup</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Error</span><span class="hl-1">(</span><span class="hl-2">&quot;Operation cancelled&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:3-integrate-with-native-apis" class="tsd-anchor"></a><h4 class="tsd-anchor-link">3. Integrate with Native APIs<a href="#md:3-integrate-with-native-apis" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h4><p>Many Web APIs accept <code>AbortSignal</code>:</p>
<ul>
<li><code>fetch(url, { signal })</code></li>
<li><code>setTimeout(callback, delay, { signal })</code></li>
<li>Custom async operations</li>
</ul>
<a id="md:4-avoid-nested-queuing" class="tsd-anchor"></a><h3 class="tsd-anchor-link">4. Avoid Nested Queuing<a href="#md:4-avoid-nested-queuing" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>The Queue prevents deadlocks by rejecting attempts to queue tasks from within running tasks. Structure your code to avoid this pattern.</p>
<a id="md:5-handle-aborterror-gracefully" class="tsd-anchor"></a><h3 class="tsd-anchor-link">5. Handle AbortError Gracefully<a href="#md:5-handle-aborterror-gracefully" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">queue</span><span class="hl-1">.</span><span class="hl-0">run</span><span class="hl-1">(</span><span class="hl-4">task</span><span class="hl-1">);</span><br/><span class="hl-1">} </span><span class="hl-3">catch</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">error</span><span class="hl-1">.</span><span class="hl-4">name</span><span class="hl-1"> === </span><span class="hl-2">&quot;AbortError&quot;</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-5">// Expected cancellation, handle appropriately</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1">;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">  </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">error</span><span class="hl-1">; </span><span class="hl-5">// Re-throw unexpected errors</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<hr>
<p><em>Cooperative task scheduling with professional-grade cancellation support</em></p>
<a id="md:real-world-examples" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Real-World Examples<a href="#md:real-world-examples" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:database-connection-pool-manager" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Database Connection Pool Manager<a href="#md:database-connection-pool-manager" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">DatabaseManager</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-4">semaphore</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Semaphore</span><span class="hl-1">(</span><span class="hl-10">10</span><span class="hl-1">); </span><span class="hl-5">// Max 10 concurrent queries</span><br/><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-4">sql</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">?: </span><span class="hl-8">any</span><span class="hl-1">[]) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">semaphore</span><span class="hl-1">.</span><span class="hl-0">withPermit</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">connection</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">pool</span><span class="hl-1">.</span><span class="hl-0">getConnection</span><span class="hl-1">();</span><br/><span class="hl-1">        </span><span class="hl-3">try</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">query</span><span class="hl-1">(</span><span class="hl-4">sql</span><span class="hl-1">, </span><span class="hl-4">params</span><span class="hl-1">);</span><br/><span class="hl-1">        } </span><span class="hl-3">finally</span><span class="hl-1"> {</span><br/><span class="hl-1">          </span><span class="hl-4">connection</span><span class="hl-1">.</span><span class="hl-0">release</span><span class="hl-1">();</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      { </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-10">30000</span><span class="hl-1"> } </span><span class="hl-5">// 30 second timeout</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">shutdown</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">semaphore</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">pool</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">();</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:rate-limited-api-client" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Rate-Limited API Client<a href="#md:rate-limited-api-client" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">class</span><span class="hl-1"> </span><span class="hl-8">APIClient</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">private</span><span class="hl-1"> </span><span class="hl-4">rateLimiter</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Semaphore</span><span class="hl-1">(</span><span class="hl-10">5</span><span class="hl-1">); </span><span class="hl-5">// Max 5 concurrent requests</span><br/><br/><span class="hl-1">  </span><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-0">fetchUser</span><span class="hl-1">(</span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1">, </span><span class="hl-4">signal</span><span class="hl-1">?: </span><span class="hl-8">AbortSignal</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-6">this</span><span class="hl-1">.</span><span class="hl-4">rateLimiter</span><span class="hl-1">.</span><span class="hl-0">withPermit</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">response</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">`/api/users/</span><span class="hl-6">${</span><span class="hl-4">id</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">, { </span><span class="hl-4">signal</span><span class="hl-1"> });</span><br/><span class="hl-1">        </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">response</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span><br/><span class="hl-1">      },</span><br/><span class="hl-1">      { </span><span class="hl-4">signal</span><span class="hl-1">, </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-10">10000</span><span class="hl-1"> }</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:batch-processing-with-progress" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Batch Processing with Progress<a href="#md:batch-processing-with-progress" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-6">async</span><span class="hl-1"> </span><span class="hl-6">function</span><span class="hl-1"> </span><span class="hl-0">processBatch</span><span class="hl-1">(</span><span class="hl-4">items</span><span class="hl-1">: </span><span class="hl-8">any</span><span class="hl-1">[]) {</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">semaphore</span><span class="hl-1"> = </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Semaphore</span><span class="hl-1">(</span><span class="hl-10">3</span><span class="hl-1">); </span><span class="hl-5">// Max 3 concurrent items</span><br/><span class="hl-1">  </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">results</span><span class="hl-1"> = [];</span><br/><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Starting batch processing...&quot;</span><span class="hl-1">);</span><br/><br/><span class="hl-1">  </span><span class="hl-3">for</span><span class="hl-1"> (</span><span class="hl-6">const</span><span class="hl-1"> [</span><span class="hl-7">index</span><span class="hl-1">, </span><span class="hl-7">item</span><span class="hl-1">] </span><span class="hl-6">of</span><span class="hl-1"> </span><span class="hl-4">items</span><span class="hl-1">.</span><span class="hl-0">entries</span><span class="hl-1">()) {</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">semaphore</span><span class="hl-1">.</span><span class="hl-0">withPermit</span><span class="hl-1">(</span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">`Processing item </span><span class="hl-6">${</span><span class="hl-4">index</span><span class="hl-9"> </span><span class="hl-1">+</span><span class="hl-9"> </span><span class="hl-10">1</span><span class="hl-6">}</span><span class="hl-2">/</span><span class="hl-6">${</span><span class="hl-4">items</span><span class="hl-9">.</span><span class="hl-4">length</span><span class="hl-6">}</span><span class="hl-2">`</span><span class="hl-1">);</span><br/><span class="hl-1">      </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">processItem</span><span class="hl-1">(</span><span class="hl-4">item</span><span class="hl-1">);</span><br/><span class="hl-1">    });</span><br/><br/><span class="hl-1">    </span><span class="hl-4">results</span><span class="hl-1">.</span><span class="hl-0">push</span><span class="hl-1">(</span><span class="hl-4">result</span><span class="hl-1">);</span><br/><br/><span class="hl-1">    </span><span class="hl-5">// Show progress</span><br/><span class="hl-1">    </span><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">metrics</span><span class="hl-1"> = </span><span class="hl-4">semaphore</span><span class="hl-1">.</span><span class="hl-0">getMetrics</span><span class="hl-1">();</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><br/><span class="hl-1">      </span><span class="hl-2">`Active: </span><span class="hl-6">${</span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">maxPermits</span><span class="hl-9"> </span><span class="hl-1">-</span><span class="hl-9"> </span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">availablePermits</span><span class="hl-6">}</span><span class="hl-2">, Waiting: </span><span class="hl-6">${</span><br/><span class="hl-9">        </span><span class="hl-4">metrics</span><span class="hl-9">.</span><span class="hl-4">waitingCount</span><br/><span class="hl-9">      </span><span class="hl-6">}</span><span class="hl-2">`</span><br/><span class="hl-1">    );</span><br/><span class="hl-1">  }</span><br/><br/><span class="hl-1">  </span><span class="hl-4">semaphore</span><span class="hl-1">.</span><span class="hl-0">dispose</span><span class="hl-1">();</span><br/><span class="hl-1">  </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&quot;Batch processing complete!&quot;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">results</span><span class="hl-1">;</span><br/><span class="hl-1">}</span>
</code><button type="button">Copy</button></pre>

<a id="md:best-practices-2" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Best Practices<a href="#md:best-practices-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ol>
<li><strong>Always dispose</strong>: Clean up your semaphores when finished to prevent memory leaks</li>
<li><strong>Use withPermit()</strong>: It's cleaner and prevents resource leaks</li>
<li><strong>Set timeouts</strong>: Don't let operations hang forever</li>
<li><strong>Monitor metrics</strong>: Keep an eye on utilization to tune your permit count</li>
<li><strong>Handle errors</strong>: Timeouts and cancellations throw errors - catch them!</li>
</ol>
<a id="md:common-pitfalls" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Common Pitfalls<a href="#md:common-pitfalls" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><ul>
<li><strong>Forgetting to release</strong>: Manual acquire/release is error-prone - prefer <code>withPermit()</code></li>
<li><strong>No timeout</strong>: Operations can hang forever without timeouts</li>
<li><strong>Ignoring disposal</strong>: Always dispose semaphores to prevent memory leaks</li>
<li><strong>Wrong permit count</strong>: Too few = slow, too many = defeats the purpose</li>
</ul>
<a id="md:anonymous-ids-because-naming-things-is-hard" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Anonymous IDs: Because Naming Things Is Hard<a href="#md:anonymous-ids-because-naming-things-is-hard" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>One of our favorite quality-of-life features: <strong>anonymous IDs</strong>. Instead of manually naming every component, the framework can generate unique symbol-based identifiers based on your file path and variable name. It's like having a really good naming assistant who never gets tired.</p>
<a id="md:how-anonymous-ids-work" class="tsd-anchor"></a><h3 class="tsd-anchor-link">How Anonymous IDs Work<a href="#md:how-anonymous-ids-work" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>When you omit the <code>id</code> property, the framework generates a unique symbol based on file path. Takes up until first 'src' or 'node_modules' and generates based on the paths.</p>
<pre><code class="typescript"><span class="hl-5">// In src/services/email.ts</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">emailService</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">// Generated ID: Symbol(&#39;services.email.resource&#39;)</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">EmailService</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// In src/tasks/user.ts</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">createUser</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-5">// Generated ID: Symbol(&#39;tasks.user.task&#39;)</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">emailService</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">userData</span><span class="hl-1">, { </span><span class="hl-4">emailService</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Business logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:benefits-of-anonymous-ids" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Benefits of Anonymous IDs<a href="#md:benefits-of-anonymous-ids" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ol>
<li><strong>Less Bikeshedding</strong>: No more debates about naming conventions</li>
<li><strong>Automatic Uniqueness</strong>: Guaranteed collision-free identifiers</li>
<li><strong>Faster Prototyping</strong>: Just write code, framework handles the rest</li>
<li><strong>Refactor-Friendly</strong>: Rename files/variables and IDs update automatically</li>
<li><strong>Stack Trace Integration</strong>: Error messages include helpful file locations</li>
</ol>
<a id="md:when-to-use-manual-vs-anonymous-ids" class="tsd-anchor"></a><h3 class="tsd-anchor-link">When to Use Manual vs Anonymous IDs<a href="#md:when-to-use-manual-vs-anonymous-ids" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><table>
<thead>
<tr>
<th>Use Case</th>
<th>Recommendation</th>
<th>Reason</th>
</tr>
</thead>
<tbody>
<tr>
<td>Internal tasks</td>
<td>Anonymous</td>
<td>No external references needed</td>
</tr>
<tr>
<td>Event definitions</td>
<td>Manual</td>
<td>Need predictable names for listeners</td>
</tr>
<tr>
<td>Public APIs</td>
<td>Manual</td>
<td>External modules need stable references</td>
</tr>
<tr>
<td>Middleware</td>
<td>Manual</td>
<td>Often reused across projects</td>
</tr>
<tr>
<td>Configuration resources</td>
<td>Anonymous</td>
<td>Usually internal infrastructure</td>
</tr>
<tr>
<td>Test doubles/mocks</td>
<td>Anonymous</td>
<td>One-off usage in tests</td>
</tr>
<tr>
<td>Cross-module services</td>
<td>Manual</td>
<td>Multiple files depend on them</td>
</tr>
</tbody>
</table>
<a id="md:anonymous-id-examples-by-pattern" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Anonymous ID Examples by Pattern<a href="#md:anonymous-id-examples-by-pattern" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><pre><code class="typescript"><span class="hl-5">// ✅ Great for anonymous IDs</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">database</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">init</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-0">Database</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-0">dispose</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">db</span><span class="hl-1">) </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-4">db</span><span class="hl-1">.</span><span class="hl-0">close</span><span class="hl-1">(),</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">processPayment</span><span class="hl-1"> = </span><span class="hl-0">task</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">dependencies:</span><span class="hl-1"> { </span><span class="hl-4">database</span><span class="hl-1"> },</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> (</span><span class="hl-4">payment</span><span class="hl-1">, { </span><span class="hl-4">database</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Internal business logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// ✅ Better with manual IDs</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">paymentProcessed</span><span class="hl-1"> = </span><span class="hl-0">event</span><span class="hl-1">&lt;{ </span><span class="hl-4">paymentId</span><span class="hl-1">: </span><span class="hl-8">string</span><span class="hl-1"> }&gt;({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.events.paymentProcessed&quot;</span><span class="hl-1">, </span><span class="hl-5">// Other modules listen to this</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">authMiddleware</span><span class="hl-1"> = </span><span class="hl-0">middleware</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app.middleware.auth&quot;</span><span class="hl-1">, </span><span class="hl-5">// Reused across multiple tasks</span><br/><span class="hl-1">  </span><span class="hl-0">run</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-6">async</span><span class="hl-1"> ({ </span><span class="hl-4">task</span><span class="hl-1">, </span><span class="hl-4">next</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">// Auth logic</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-5">// ✅ Mixed approach - totally fine!</span><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-0">resource</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-4">id:</span><span class="hl-1"> </span><span class="hl-2">&quot;app&quot;</span><span class="hl-1">, </span><span class="hl-5">// Main entry point gets manual ID</span><br/><span class="hl-1">  </span><span class="hl-4">register:</span><span class="hl-1"> [</span><br/><span class="hl-1">    </span><span class="hl-4">database</span><span class="hl-1">, </span><span class="hl-5">// Anonymous</span><br/><span class="hl-1">    </span><span class="hl-4">processPayment</span><span class="hl-1">, </span><span class="hl-5">// Anonymous</span><br/><span class="hl-1">    </span><span class="hl-4">paymentProcessed</span><span class="hl-1">, </span><span class="hl-5">// Manual</span><br/><span class="hl-1">    </span><span class="hl-4">authMiddleware</span><span class="hl-1">, </span><span class="hl-5">// Manual</span><br/><span class="hl-1">  ],</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:debugging-with-anonymous-ids" class="tsd-anchor"></a><h3 class="tsd-anchor-link">Debugging with Anonymous IDs<a href="#md:debugging-with-anonymous-ids" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><p>Anonymous IDs show up clearly in error messages and logs:</p>
<pre><code class="typescript"><span class="hl-5">// Error message example:</span><br/><span class="hl-5">// TaskRunError: Task failed at Symbol(&#39;tasks.payment.task&#39;)</span><br/><span class="hl-5">//   at file:///project/src/tasks/payment.ts:15:23</span><br/><br/><span class="hl-5">// Logging with context:</span><br/><span class="hl-4">logger</span><span class="hl-1">.</span><span class="hl-0">info</span><span class="hl-1">(</span><span class="hl-2">&quot;Processing payment&quot;</span><span class="hl-1">, {</span><br/><span class="hl-1">  </span><span class="hl-4">taskId:</span><span class="hl-1"> </span><span class="hl-4">processPayment</span><span class="hl-1">.</span><span class="hl-4">definition</span><span class="hl-1">.</span><span class="hl-4">id</span><span class="hl-1">, </span><span class="hl-5">// Symbol(&#39;tasks.payment.task&#39;)</span><br/><span class="hl-1">  </span><span class="hl-4">file:</span><span class="hl-1"> </span><span class="hl-2">&quot;src/tasks/payment.ts&quot;</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

<a id="md:why-choose-bluelibs-runner" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Why Choose BlueLibs Runner?<a href="#md:why-choose-bluelibs-runner" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><a id="md:what-you-get" class="tsd-anchor"></a><h3 class="tsd-anchor-link">What You Get<a href="#md:what-you-get" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li><strong>Type Safety</strong>: Full TypeScript support with intelligent inference</li>
<li><strong>Testability</strong>: Everything is mockable and testable by design</li>
<li><strong>Flexibility</strong>: Compose your app however you want</li>
<li><strong>Performance</strong>: Built-in caching and optimization</li>
<li><strong>Clarity</strong>: Explicit dependencies, no hidden magic</li>
<li><strong>Developer Experience</strong>: Helpful error messages and clear patterns</li>
</ul>
<a id="md:what-you-dont-get" class="tsd-anchor"></a><h3 class="tsd-anchor-link">What You Don't Get<a href="#md:what-you-dont-get" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h3><ul>
<li>Complex configuration files that require a PhD to understand</li>
<li>Decorator hell that makes your code look like a Christmas tree</li>
<li>Hidden dependencies that break when you least expect it</li>
<li>Framework lock-in that makes you feel trapped</li>
<li>Mysterious behavior at runtime that makes you question reality</li>
</ul>
<a id="md:the-migration-path" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Migration Path<a href="#md:the-migration-path" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>Coming from Express? No problem. Coming from NestJS? We feel your pain. Coming from Spring Boot? Welcome to the light side.</p>
<p>The beauty of BlueLibs Runner is that you can adopt it incrementally. Start with one task, one resource, and gradually refactor your existing code. No big bang rewrites required - your sanity will thank you.</p>
<a id="md:community--support" class="tsd-anchor"></a><h2 class="tsd-anchor-link">Community &amp; Support<a href="#md:community--support" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This is part of the <a href="https://www.bluelibs.com" target="_blank" class="external">BlueLibs</a> ecosystem. We're not trying to reinvent everything – just the parts that were broken.</p>
<ul>
<li><a href="https://github.com/bluelibs/runner" target="_blank" class="external">GitHub Repository</a> - ⭐ if you find this useful</li>
<li><a href="https://bluelibs.github.io/runner/" target="_blank" class="external">Documentation</a> - When you need the full details</li>
<li><a href="https://github.com/bluelibs/runner/issues" target="_blank" class="external">Issues</a> - When something breaks (or you want to make it better)</li>
</ul>
<a id="md:the-bottom-line" class="tsd-anchor"></a><h2 class="tsd-anchor-link">The Bottom Line<a href="#md:the-bottom-line" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>BlueLibs Runner is what happens when you take all the good ideas from modern frameworks and leave out the parts that make you want to switch careers. It's TypeScript-first, test-friendly, and actually makes sense when you read it six months later.</p>
<p>Give it a try. Your future self (and your team) will thank you.</p>
<p><em>P.S. - Yes, we know there are 47 other JavaScript frameworks. This one's different. (No, really, it is.)</em></p>
<a id="md:license" class="tsd-anchor"></a><h2 class="tsd-anchor-link">License<a href="#md:license" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24"><use href="assets/icons.svg#icon-anchor"></use></svg></a></h2><p>This project is licensed under the MIT License - see the <a href="media/LICENSE.md">LICENSE.md</a> file for details.</p>
</div></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div><details open class="tsd-accordion tsd-page-navigation"><summary class="tsd-accordion-summary"><h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="assets/icons.svg#icon-chevronDown"></use></svg>On This Page</h3></summary><div class="tsd-accordion-details"><a href="#md:bluelibs-runner-the-framework-that-actually-makes-sense"><span>Blue<wbr/>Libs <wbr/>Runner: <wbr/>The <wbr/>Framework <wbr/>That <wbr/>Actually <wbr/>Makes <wbr/>Sense</span></a><ul><li><a href="#md:what-is-this-thing"><span>What <wbr/>Is <wbr/>This <wbr/>Thing?</span></a></li><li><ul><li><a href="#md:the-core-philosophy-aka-why-we-built-this"><span>The <wbr/>Core <wbr/>Philosophy (AKA <wbr/>Why <wbr/>We <wbr/>Built <wbr/>This)</span></a></li></ul></li><li><a href="#md:quick-start-the-just-show-me-code-section"><span>Quick <wbr/>Start (<wbr/>The &quot;<wbr/>Just <wbr/>Show <wbr/>Me <wbr/>Code&quot; <wbr/>Section)</span></a></li><li><a href="#md:the-big-four-your-new-building-blocks"><span>The <wbr/>Big <wbr/>Four: <wbr/>Your <wbr/>New <wbr/>Building <wbr/>Blocks</span></a></li><li><ul><li><a href="#md:1-tasks-the-heart-of-your-business-logic"><span>1. <wbr/>Tasks: <wbr/>The <wbr/>Heart of <wbr/>Your <wbr/>Business <wbr/>Logic</span></a></li><li><ul><li><a href="#md:when-to-task-and-when-not-to-task"><span>When to <wbr/>Task and <wbr/>When <wbr/>Not to <wbr/>Task</span></a></li></ul></li><li><a href="#md:2-resources-your-singletons-that-dont-suck"><span>2. <wbr/>Resources: <wbr/>Your <wbr/>Singletons <wbr/>That <wbr/>Don&#39;t <wbr/>Suck</span></a></li><li><ul><li><a href="#md:resource-configuration-because-hardcoding-is-for-amateurs"><span>Resource <wbr/>Configuration: <wbr/>Because <wbr/>Hardcoding <wbr/>Is for <wbr/>Amateurs</span></a></li><li><a href="#md:shared-context-between-init-and-dispose"><span>Shared <wbr/>Context <wbr/>Between <wbr/>Init and <wbr/>Dispose</span></a></li></ul></li><li><a href="#md:3-events-async-communication-that-actually-works"><span>3. <wbr/>Events: <wbr/>Async <wbr/>Communication <wbr/>That <wbr/>Actually <wbr/>Works</span></a></li><li><ul><li><a href="#md:wildcard-events-for-when-you-want-to-know-everything"><span>Wildcard <wbr/>Events: <wbr/>For <wbr/>When <wbr/>You <wbr/>Want to <wbr/>Know <wbr/>Everything</span></a></li><li><a href="#md:tasks-and-resources-built-in-events"><span>Tasks and <wbr/>Resources built-<wbr/>in events</span></a></li><li><a href="#md:global-events-the-systems-built-in-gossip-network"><span>Global <wbr/>Events: <wbr/>The <wbr/>System&#39;s <wbr/>Built-<wbr/>in <wbr/>Gossip <wbr/>Network</span></a></li><li><a href="#md:event-propagation-control-with-stoppropagation"><span>Event <wbr/>Propagation <wbr/>Control with stop<wbr/>Propagation()</span></a></li></ul></li><li><a href="#md:4-middleware-the-interceptor-pattern-done-right"><span>4. <wbr/>Middleware: <wbr/>The <wbr/>Interceptor <wbr/>Pattern <wbr/>Done <wbr/>Right</span></a></li><li><ul><li><a href="#md:global-middleware-apply-everywhere-configure-once"><span>Global <wbr/>Middleware: <wbr/>Apply <wbr/>Everywhere, <wbr/>Configure <wbr/>Once</span></a></li></ul></li></ul></li><li><a href="#md:context-request-scoped-data-that-doesnt-drive-you-insane"><span>Context: <wbr/>Request-<wbr/>Scoped <wbr/>Data <wbr/>That <wbr/>Doesn&#39;t <wbr/>Drive <wbr/>You <wbr/>Insane</span></a></li><li><ul><li><a href="#md:context-with-middleware-the-power-couple"><span>Context with <wbr/>Middleware: <wbr/>The <wbr/>Power <wbr/>Couple</span></a></li></ul></li><li><a href="#md:dependency-management-the-index-pattern"><span>Dependency <wbr/>Management: <wbr/>The <wbr/>Index <wbr/>Pattern</span></a></li><li><a href="#md:error-handling-graceful-failures"><span>Error <wbr/>Handling: <wbr/>Graceful <wbr/>Failures</span></a></li><li><a href="#md:caching-built-in-performance"><span>Caching: <wbr/>Built-<wbr/>in <wbr/>Performance</span></a></li><li><a href="#md:retrying-failed-operations"><span>Retrying <wbr/>Failed <wbr/>Operations</span></a></li><li><a href="#md:logging-because-consolelog-isnt-professional"><span>Logging: <wbr/>Because <wbr/>Console.log <wbr/>Isn&#39;t <wbr/>Professional</span></a></li><li><ul><li><a href="#md:quick-start-basic-logging"><span>Quick <wbr/>Start: <wbr/>Basic <wbr/>Logging</span></a></li><li><a href="#md:log-levels-from-whispers-to-screams"><span>Log <wbr/>Levels: <wbr/>From <wbr/>Whispers to <wbr/>Screams</span></a></li><li><a href="#md:structured-logging-more-than-just-strings"><span>Structured <wbr/>Logging: <wbr/>More <wbr/>Than <wbr/>Just <wbr/>Strings</span></a></li><li><a href="#md:context-aware-logging-the-with-method"><span>Context-<wbr/>Aware <wbr/>Logging: <wbr/>The with() <wbr/>Method</span></a></li><li><a href="#md:print-threshold-control-what-shows-up"><span>Print <wbr/>Threshold: <wbr/>Control <wbr/>What <wbr/>Shows <wbr/>Up</span></a></li><li><a href="#md:event-driven-log-handling-ship-logs-anywhere"><span>Event-<wbr/>Driven <wbr/>Log <wbr/>Handling: <wbr/>Ship <wbr/>Logs <wbr/>Anywhere</span></a></li><li><a href="#md:integration-with-winston-best-of-both-worlds"><span>Integration with <wbr/>Winston: <wbr/>Best of <wbr/>Both <wbr/>Worlds</span></a></li><li><a href="#md:advanced-custom-log-formatters"><span>Advanced: <wbr/>Custom <wbr/>Log <wbr/>Formatters</span></a></li><li><a href="#md:log-structure-what-you-get"><span>Log <wbr/>Structure: <wbr/>What <wbr/>You <wbr/>Get</span></a></li><li><a href="#md:debugging-tips--best-practices"><span>Debugging <wbr/>Tips &amp; <wbr/>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#md:1-use-structured-data-liberally"><span>1. <wbr/>Use <wbr/>Structured <wbr/>Data <wbr/>Liberally</span></a></li><li><a href="#md:2-include-context-in-errors"><span>2. <wbr/>Include <wbr/>Context in <wbr/>Errors</span></a></li><li><a href="#md:3-use-different-log-levels-appropriately"><span>3. <wbr/>Use <wbr/>Different <wbr/>Log <wbr/>Levels <wbr/>Appropriately</span></a></li><li><a href="#md:4-create-domain-specific-loggers"><span>4. <wbr/>Create <wbr/>Domain-<wbr/>Specific <wbr/>Loggers</span></a></li></ul></li></ul></li><li><a href="#md:meta-documenting-and-organizing-your-components"><span>Meta: <wbr/>Documenting and <wbr/>Organizing <wbr/>Your <wbr/>Components</span></a></li><li><ul><li><a href="#md:basic-metadata-properties"><span>Basic <wbr/>Metadata <wbr/>Properties</span></a></li><li><a href="#md:simple-documentation-example"><span>Simple <wbr/>Documentation <wbr/>Example</span></a></li><li><a href="#md:tags-the-powerful-classification-system"><span>Tags: <wbr/>The <wbr/>Powerful <wbr/>Classification <wbr/>System</span></a></li><li><ul><li><a href="#md:string-tags-for-simple-classification"><span>String <wbr/>Tags for <wbr/>Simple <wbr/>Classification</span></a></li><li><a href="#md:advanced-tags-with-configuration"><span>Advanced <wbr/>Tags with <wbr/>Configuration</span></a></li><li><a href="#md:smart-middleware-using-structured-tags"><span>Smart <wbr/>Middleware <wbr/>Using <wbr/>Structured <wbr/>Tags</span></a></li></ul></li><li><a href="#md:when-to-use-metadata"><span>When to <wbr/>Use <wbr/>Metadata</span></a></li><li><ul><li><a href="#md:✅-great-use-cases"><span>✅ <wbr/>Great <wbr/>Use <wbr/>Cases</span></a></li><li><a href="#md:❌-when-not-to-use-metadata"><span>❌ <wbr/>When NOT to <wbr/>Use <wbr/>Metadata</span></a></li></ul></li><li><a href="#md:extending-metadata-custom-properties"><span>Extending <wbr/>Metadata: <wbr/>Custom <wbr/>Properties</span></a></li><li><a href="#md:advanced-patterns"><span>Advanced <wbr/>Patterns</span></a></li><li><ul><li><a href="#md:tag-based-component-selection"><span>Tag-<wbr/>Based <wbr/>Component <wbr/>Selection</span></a></li><li><a href="#md:dynamic-middleware-application"><span>Dynamic <wbr/>Middleware <wbr/>Application</span></a></li></ul></li></ul></li><li><a href="#md:advanced-usage-when-you-need-more-power"><span>Advanced <wbr/>Usage: <wbr/>When <wbr/>You <wbr/>Need <wbr/>More <wbr/>Power</span></a></li><li><ul><li><a href="#md:overrides-swapping-components-at-runtime"><span>Overrides: <wbr/>Swapping <wbr/>Components at <wbr/>Runtime</span></a></li><li><a href="#md:namespacing-keeping-things-organized"><span>Namespacing: <wbr/>Keeping <wbr/>Things <wbr/>Organized</span></a></li><li><a href="#md:factory-pattern-for-when-you-need-instances"><span>Factory <wbr/>Pattern: <wbr/>For <wbr/>When <wbr/>You <wbr/>Need <wbr/>Instances</span></a></li><li><a href="#md:internal-services-for-when-you-need-direct-access"><span>Internal <wbr/>Services: <wbr/>For <wbr/>When <wbr/>You <wbr/>Need <wbr/>Direct <wbr/>Access</span></a></li><li><a href="#md:dependency-patterns-static-vs-dynamic"><span>Dependency <wbr/>Patterns: <wbr/>Static vs <wbr/>Dynamic</span></a></li><li><a href="#md:handling-circular-type-dependencies-breaking-the-chain"><span>Handling <wbr/>Circular &quot;<wbr/>Type&quot; <wbr/>Dependencies: <wbr/>Breaking the <wbr/>Chain</span></a></li><li><ul><li><a href="#md:the-problem-self-referencing-types"><span>The <wbr/>Problem: <wbr/>Self-<wbr/>Referencing <wbr/>Types</span></a></li><li><a href="#md:the-solution-type-annotations"><span>The <wbr/>Solution: <wbr/>Type <wbr/>Annotations</span></a></li><li><a href="#md:why-this-works"><span>Why <wbr/>This <wbr/>Works</span></a></li><li><a href="#md:best-practices"><span>Best <wbr/>Practices</span></a></li><li><a href="#md:example-with-dependencies"><span>Example with <wbr/>Dependencies</span></a></li></ul></li></ul></li><li><a href="#md:real-world-example-the-complete-package"><span>Real-<wbr/>World <wbr/>Example: <wbr/>The <wbr/>Complete <wbr/>Package</span></a></li><li><a href="#md:testing-actually-enjoyable"><span>Testing: <wbr/>Actually <wbr/>Enjoyable</span></a></li><li><ul><li><a href="#md:unit-testing-mock-everything-test-everything"><span>Unit <wbr/>Testing: <wbr/>Mock <wbr/>Everything, <wbr/>Test <wbr/>Everything</span></a></li><li><a href="#md:integration-testing-the-real-deal-but-actually-fun"><span>Integration <wbr/>Testing: <wbr/>The <wbr/>Real <wbr/>Deal (<wbr/>But <wbr/>Actually <wbr/>Fun)</span></a></li></ul></li><li><a href="#md:semaphore"><span>Semaphore</span></a></li><li><ul><li><a href="#md:quick-start"><span>Quick <wbr/>Start</span></a></li><li><a href="#md:the-elegant-approach-withpermit"><span>The <wbr/>Elegant <wbr/>Approach: with<wbr/>Permit()</span></a></li><li><a href="#md:timeout-support"><span>Timeout <wbr/>Support</span></a></li><li><a href="#md:cancellation-support"><span>Cancellation <wbr/>Support</span></a></li><li><a href="#md:monitoring-metrics--debugging"><span>Monitoring: <wbr/>Metrics &amp; <wbr/>Debugging</span></a></li><li><a href="#md:resource-cleanup"><span>Resource <wbr/>Cleanup</span></a></li></ul></li><li><a href="#md:queue"><span>Queue</span></a></li><li><ul><li><a href="#md:fifo-ordering"><span>FIFO <wbr/>Ordering</span></a></li><li><a href="#md:deadlock-detective"><span>Deadlock <wbr/>Detective</span></a></li><li><a href="#md:graceful-disposal--cancellation"><span>Graceful <wbr/>Disposal &amp; <wbr/>Cancellation</span></a></li><li><a href="#md:basic-example"><span>Basic <wbr/>Example</span></a></li><li><a href="#md:abortcontroller-integration"><span>Abort<wbr/>Controller <wbr/>Integration</span></a></li><li><ul><li><a href="#md:example-long-running-task-with-cancellation-support"><span>Example: <wbr/>Long-<wbr/>running <wbr/>Task with <wbr/>Cancellation <wbr/>Support</span></a></li><li><a href="#md:example-network-request-with-timeout"><span>Example: <wbr/>Network <wbr/>Request with <wbr/>Timeout</span></a></li><li><a href="#md:example-file-processing-with-progress-tracking"><span>Example: <wbr/>File <wbr/>Processing with <wbr/>Progress <wbr/>Tracking</span></a></li></ul></li></ul></li><li><a href="#md:the-magic-behind-the-curtain"><span>The <wbr/>Magic <wbr/>Behind the <wbr/>Curtain</span></a></li><li><ul><li><a href="#md:internal-state"><span>Internal <wbr/>State</span></a></li><li><a href="#md:error-handling"><span>Error <wbr/>Handling</span></a></li><li><a href="#md:best-practices-1"><span>Best <wbr/>Practices</span></a></li><li><ul><li><a href="#md:1-always-dispose-resources"><span>1. <wbr/>Always <wbr/>Dispose <wbr/>Resources</span></a></li><li><a href="#md:2-implement-cooperative-cancellation"><span>2. <wbr/>Implement <wbr/>Cooperative <wbr/>Cancellation</span></a></li><li><a href="#md:3-integrate-with-native-apis"><span>3. <wbr/>Integrate with <wbr/>Native APIs</span></a></li></ul></li><li><a href="#md:4-avoid-nested-queuing"><span>4. <wbr/>Avoid <wbr/>Nested <wbr/>Queuing</span></a></li><li><a href="#md:5-handle-aborterror-gracefully"><span>5. <wbr/>Handle <wbr/>Abort<wbr/>Error <wbr/>Gracefully</span></a></li></ul></li><li><a href="#md:real-world-examples"><span>Real-<wbr/>World <wbr/>Examples</span></a></li><li><ul><li><a href="#md:database-connection-pool-manager"><span>Database <wbr/>Connection <wbr/>Pool <wbr/>Manager</span></a></li><li><a href="#md:rate-limited-api-client"><span>Rate-<wbr/>Limited API <wbr/>Client</span></a></li><li><a href="#md:batch-processing-with-progress"><span>Batch <wbr/>Processing with <wbr/>Progress</span></a></li></ul></li><li><a href="#md:best-practices-2"><span>Best <wbr/>Practices</span></a></li><li><a href="#md:common-pitfalls"><span>Common <wbr/>Pitfalls</span></a></li><li><a href="#md:anonymous-ids-because-naming-things-is-hard"><span>Anonymous IDs: <wbr/>Because <wbr/>Naming <wbr/>Things <wbr/>Is <wbr/>Hard</span></a></li><li><ul><li><a href="#md:how-anonymous-ids-work"><span>How <wbr/>Anonymous IDs <wbr/>Work</span></a></li><li><a href="#md:benefits-of-anonymous-ids"><span>Benefits of <wbr/>Anonymous IDs</span></a></li><li><a href="#md:when-to-use-manual-vs-anonymous-ids"><span>When to <wbr/>Use <wbr/>Manual vs <wbr/>Anonymous IDs</span></a></li><li><a href="#md:anonymous-id-examples-by-pattern"><span>Anonymous ID <wbr/>Examples by <wbr/>Pattern</span></a></li><li><a href="#md:debugging-with-anonymous-ids"><span>Debugging with <wbr/>Anonymous IDs</span></a></li></ul></li><li><a href="#md:why-choose-bluelibs-runner"><span>Why <wbr/>Choose <wbr/>Blue<wbr/>Libs <wbr/>Runner?</span></a></li><li><ul><li><a href="#md:what-you-get"><span>What <wbr/>You <wbr/>Get</span></a></li><li><a href="#md:what-you-dont-get"><span>What <wbr/>You <wbr/>Don&#39;t <wbr/>Get</span></a></li></ul></li><li><a href="#md:the-migration-path"><span>The <wbr/>Migration <wbr/>Path</span></a></li><li><a href="#md:community--support"><span>Community &amp; <wbr/>Support</span></a></li><li><a href="#md:the-bottom-line"><span>The <wbr/>Bottom <wbr/>Line</span></a></li><li><a href="#md:license"><span>License</span></a></li></ul></div></details></div><div class="site-menu"><nav class="tsd-navigation"><a href="modules.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="assets/icons.svg#icon-1"></use></svg><span>@bluelibs/runner - v3.3.2</span></a><ul class="tsd-small-nested-navigation" id="tsd-nav-container" data-base="."><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div><script>
          try {
            const generateLinkElement = document.querySelector(".tsd-generator a");
            const link = document.createElement("a");
            Object.assign(link, {
              href: "https://github.com/dmnsgn/typedoc-material-theme",
              target: "_blank",
              rel: "noreferrer",
              innerText: "typedoc-material-theme."
            });
            generateLinkElement.insertAdjacentElement("afterend", link);
            generateLinkElement.insertAdjacentText("afterend", " with ");
          } catch (error) {

          }
        </script></body></html>
